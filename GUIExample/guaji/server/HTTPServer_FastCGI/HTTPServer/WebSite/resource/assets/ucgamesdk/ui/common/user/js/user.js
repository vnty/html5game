S.SSCL.LoginHist=Backbone.Collection.extend({initialize:function(){_.bindAll(this)},getHistory:function(s){var e=s.success?s.success:null,t=s.error?s.error:null,i=S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.GET_LOGIN_GAMEHISTORYSYNC,s.data);i.success?(this.reset(i.data),e.apply(this,[this,i])):(this.reset([]),t.apply(this,[this,i]))},getServerHistory:function(s){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.QUERY_HISTORY,this.fetch(s)},parse:function(s){return s}});S.SSCL.QuestionList=Backbone.Collection.extend({initialize:function(){_.bindAll(this)},getQuestionList:function(i){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.GET_QUESTION_HISTORY,this.fetch(i)},parse:function(i){return i}});S.SSCT.AccountManage=Backbone.Controller.extend({initialize:function(){_.bindAll(this)},getSecureState:function(e){this.secureModel=this.secureModel?this.secureModel:S.SSCT.GetHandler("Model","Secrecy"),this.secureModel.getSecureState({success:function(s,o){console.log("getSecureState success : "+JSON.stringify(o)),e.success(o.data)},error:function(s,o){console.log("getSecureState error : "+JSON.stringify(o)),e.error(o.msg)},quiet:!0})},getSecureStateDetail:function(e,s,o){this.secureModel=this.secureModel?this.secureModel:S.SSCT.GetHandler("Model","Secrecy"),this.secureModel.getSecureStateDetail({data:{items:e,name:_.isUndefined(o)?null:o},success:function(e,o){console.log("getSecureStateDetail success : "+JSON.stringify(o)),s.success(o.data)},error:function(e,o){console.log("getSecureStateDetail error : "+JSON.stringify(o)),s.error(o.msg)},quiet:!0})},sendCode2Mobile:function(e,s){this.secureModel=this.secureModel?this.secureModel:S.SSCT.GetHandler("Model","Secrecy"),this.secureModel.sendCodeToMobile({data:e,success:function(e,s){console.log("sendCodeToMobile success : "+JSON.stringify(s))},error:function(e,o){console.log("sendCodeToMobile error : "+JSON.stringify(o)),s.error(o.msg)},quiet:!0})},doBindMobile:function(e,s){this.secureModel=this.secureModel?this.secureModel:S.SSCT.GetHandler("Model","Secrecy");var o=S.global.versionCompare(S.global.version,rConfig.VERSIONS.SECURITY_VERSION);o!==!1&&o>=0&&(e.encrypt=rConfig.SECURITY_TYPE.SECURITY),this.secureModel.bindMobile({data:e,success:function(e,o){console.log("bindMobile success : "+JSON.stringify(o)),s.success()},error:function(e,o){console.log("bindMobile error : "+JSON.stringify(o)),s.error(o)},quiet:!0})},checkIsBinded:function(e,s){this.secureModel=this.secureModel?this.secureModel:S.SSCT.GetHandler("Model","Secrecy"),this.secureModel.checkIsBinded({data:e,success:function(e,o){console.log("checkIsBinded success : "+JSON.stringify(o)),s.success(o.data)},error:function(e,o){console.log("checkIsBinded error : "+JSON.stringify(o)),s.error(o.msg)},quiet:!0})},doSaveSecurityQuestions:function(e,s){var o=S.global.versionCompare(S.global.version,rConfig.VERSIONS.SECURITY_VERSION);o!==!1&&o>=0&&(e.encrypt=rConfig.SECURITY_TYPE.SECURITY),this.secureModel=this.secureModel?this.secureModel:S.SSCT.GetHandler("Model","Secrecy"),this.secureModel.saveSecurityQuestions({data:e,success:function(){s.success()},error:function(e,o){s.error(o)},quiet:!0})}});S.SSCT.Secrecy=Backbone.Controller.extend({initialize:function(){_.bindAll(this)},sendMsgToMobile:function(e,n){var r=S.SSCT.GetHandler("Model","Secrecy");r.changeUrl("sendMsgToMobile"),r.fetch({data:e,success:function(){var r=S.SSCT.GetHandler("Controller","General");r.setCacheData("phone",e.phone,1800,!0),n.success()},error:function(e,r){n.error(r.msg)},quiet:!0})},doBindMobile:function(e,n){var r=S.SSCT.GetHandler("Model","Secrecy");r.changeUrl("bindMobile"),r.fetch({data:e,success:function(){n.success()},error:function(e,r){n.error(r.msg)},quiet:!0})}});S.SSCT.Sso=Backbone.Controller.extend({initialize:function(){},CONFIG:{ACCOUNT_TYPE:{LOGIN:0,GAME_LOGIN:1},SECURITY_TYPE:{UNSECURITY:0,SECURITY:1}},histLength:{},serverHistLength:{},getHistLength:function(e){var s=this.histLength[e]?this.histLength[e]:0;return s},loginConfig:null,getLoginConfig:function(){return this.loginConfig||this.getLoginData(this.callBackMix(function(e){this.loginConfig=e})),this.loginConfig},histories:{},getHistories:function(e){return this.histories[e]?this.histories[e]:void 0},setHistories:function(e,s){this.histories[e]=s},serverHistories:{},getServerHistories:function(e){return this.serverHistories[e]?this.serverHistories[e]:void 0},validLoginData:function(e,s,r,t,i){i=i?i:{},i.error=i.error?i.error:function(){},i.success=i.success?i.success:function(){};var n={};if(0===s.length)return n.msg="密码不能为空",n.code=102,i.error(n),void 0;if(0===e.length)return n.msg="账号不能为空",n.code=101,i.error(n),void 0;if(r===this.CONFIG.ACCOUNT_TYPE.LOGIN){if(e.length<2||e.length>20)return n.msg="账号长度必须在2到20位之间",n.code=103,i.error(n),void 0;if(!rConfig.user.accountFilter.test(e)&&!rConfig.user.emailAccountFilter.test(e))return n.msg="账号格式错误",n.code=104,i.error(n),void 0;if((!t||!t.isSecurity)&&(s.length<6||s.length>20))return n.msg="密码长度必须在6到20位之间",n.code=105,i.error(n),void 0}i.success(e,s)},loginSubmit:function(e,s,r){r=r?r:{},r.error=r.error?r.error:function(){},r.success=r.success?r.success:function(){};var t=S.SSCT.GetHandler("Model","Sso");t.on("error",_.bind(function(e,s){r.error(e,{msg:s}),t.off("error")},this));var i=_.isUndefined(e.accountType)?0:e.accountType,n=_.isUndefined(e.rememberPassword)?!0:e.rememberPassword;e.accountType=i,e.rememberPassword=n;var o=t.set(e);o&&t.login({success:function(e,s){var t=S.SSCT.GetHandler("Controller","User");t.getCurUserInfo(),r.success(e,s)},error:function(e,s){r.error(e,s)},data:e,quiet:s})},getLoginData:function(e){var s=S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.GET_LOGIN_CONFIG);!_.isUndefined(s)&&s.success?(this.loginConfig=s.data,e.success(s.data)):e.error(s?s.msg:"获取登录配置失败")},getHistory:function(e,s,r){r=_.isUndefined(r)?!1:r,s=s?s:{};var t=S.SSCT.GetHandler("Collection","LoginHist"),i=this;t.getHistory({success:function(r,t){var n=[];if(_.isUndefined(t.data)||_.isEmpty(t.data)||null==t.data||(n=t.data),i.histories[e]=n,i.histLength[e]=n.length?n.length:0,e===i.CONFIG.ACCOUNT_TYPE.LOGIN){var o=[],c=0;_.each(n,function(e){if(!i.checkIsFirmSuffix(e.account)){o[c]=e,c++;var s=S.SSCT.GetHandler("Controller","General").getCacheData("user_info_"+e.account,!0);s&&(e.isRandomPassword=s.random)}}),i.histories[e]=o,i.histLength[e]=o.length?o.length:0,s.success&&s.success(o)}else s.success&&s.success(n)},error:function(e,r){s.error&&s.error(r.msg)},data:{accountType:e},quiet:r})},getServerHistory:function(e,s){s=s?s:{};var r=S.SSCT.GetHandler("Collection","LoginHist"),t=this;return t.serverHistories[e]?(s.success&&s.success(t.serverHistories[e]),void 0):(r.getServerHistory({success:function(r,i){var n=[];if(_.isUndefined(i.data.uids)||_.isEmpty(i.data.uids)||null==i.data.uids||(n=i.data.uids),e===t.CONFIG.ACCOUNT_TYPE.LOGIN){var o=[],c=0;_.each(n,function(e){if(!t.checkIsFirmSuffix(e.account)){o[c]=e,c++;var s=S.SSCT.GetHandler("Controller","General").getCacheData("user_info_"+e.account,!0);s&&(e.isRandomPassword=s.random)}}),t.serverHistories[e]=o,t.serverHistLength[e]=o.length?o.length:0,s.success&&s.success(o)}else t.serverHistories[e]=n,t.serverHistLength[e]=n.length?n.length:0,s.success&&s.success(n)},error:function(e,r){s.error&&s.error(r.msg)},data:{accountType:e},quiet:!0}),void 0)},getHistByUsername:function(e,s,r){var t=null,i=this.histories[s];_.isUndefined(e)||_.isUndefined(i)||_.each(i,function(s){s.account==e&&(t=s)}),t?r.success&&r.success(t):r.error&&r.error("找不到匹配的用户账号")},clearHistFlag:function(e){e=e?e:{};var s=sdk.PageCache.get("clear_history");s.success&&1===s.data?(S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.CLEAR_HISTORY),sdk.PageCache.del("clear_history"),e.success&&e.success()):e.error&&e.error()},getLoginCount:function(e){var s=ucf.Cache.get("login_count_info",!0)||{};return s[e]||0},updateLoginCount:function(e){var s=ucf.Cache.get("login_count_info",!0)||{},r=s[e]||0;r++,s[e]=r,ucf.Cache.set("login_count_info",s,0,!0)},validSecrecy:function(e,s,r){var t=S.SSCT.GetHandler("Controller","AccountManage");t.getSecureStateDetail(["mobile","question"],t.callBackMix(function(e){var s=e.mobile||{},t=e.question||{};1===s.code&&_.isEmpty(s.mobile)&&(1===t.code||126===t.code)&&_.isEmpty(t.password_question)?r.success(e):r.error&&r.error("safe")},function(){r.error&&r.error("fail")}))},getGameNotice:function(e){e=e?e:{},e.error=e.error?e.error:function(){},e.success=e.success?e.success:function(){};var s=S.SSCT.GetHandler("Model","Sso");s.getGameNotice({success:function(s,r){var t,i,n=r.data.msgs;if(null==n)ucf.Cache.set("game_notice",{},0,!0);else if(t=n.length,0==t)ucf.Cache.set("game_notice",{},0,!0);else{i=n[0];for(var o=t-1;o>=0;o--)parseInt(n[o].priority)<parseInt(i.priority)&&(i=n[o]);ucf.Cache.set("game_notice",i,0,!0)}e.success(i)},error:function(s,r){ucf.Cache.set("game_notice",{},0,!0),e.error(r.msg)},data:{msgType:1},quiet:!0})},checkIsFirmSuffix:function(e){var s=new RegExp("#.*#$");return s.test(e)?!0:!1},removeFirmSuffix:function(e){if(!_.isUndefined(e)&&!_.isEmpty(e)){var s=new RegExp("([sS]*)#.*#$");return e.replace(s,"$1")}return e},getLoginCaptcha:function(e,s){var r=S.SSCT.GetHandler("Model","Sso");r.getLoginCaptcha({data:{userName:e,actionType:"login",sizeType:"default"},success:function(e,r){s.success&&s.success(r.data)},error:function(e,r){s.error&&s.error(r)},quiet:!1})}});S.SSCT.User=Backbone.Controller.extend({initialize:function(){_.bindAll(this)},curUser:{},userName:"",getCurUser:function(){return this.curUser},setCurUser:function(e){this.curUser=e},getCurUserInfo:function(e){var r=S.sdkBase.request(S.sdkBase.servType.COMMON,S.sdkBase.actions.GET_CURR_USER);r.success?(this.curUser=r.data,e&&e.success&&e.success.apply(this,[r.data])):e&&e.error&&e.error.apply(this,[r.msg])},updatePass:function(e,r){var s=r.success?r.success:function(){},t=r.error?r.error:function(){},o=S.SSCT.GetHandler("Model","User");o.off("error"),o.on("error",$.proxy(function(e,r){t.apply(this,[r])},this));var c=o.set(e);c&&o.updatePass({success:$.proxy(function(){this.getCurUserInfo(this.callBackMix(function(e){ucf.Cache.set("user_info_"+e.ucid,{random:!1},0,!0)})),s()},this),error:$.proxy(function(e,r){t.apply(this,[r.msg])},this),data:e})},registerUpdatePass:function(e,r){var s=r.success?r.success:function(){},t=r.error?r.error:function(){},o=S.SSCT.GetHandler("Model","User");o.off("error"),o.on("error",$.proxy(function(e,r){t.apply(this,[r])},this));var c=o.set(e),n=this;c&&o.updatePass({success:$.proxy(function(){n.getCurUserInfo(n.callBackMix(function(r){n.setRegData(r.ucid,e.password),ucf.Cache.set("user_info_"+r.ucid,{random:!1},0,!0)})),s()},this),error:$.proxy(function(e,r){t.apply(this,[r.msg])},this),data:e})},register:function(e,r,s){r=r?r:{},s=_.isUndefined(s)?!1:s;var t=S.SSCT.GetHandler("Model","Register");t.off("error"),t.on("error",function(e,s){r.error(s)});var o=t.set(e);o&&t.register({data:e,success:$.proxy(function(e,s){this.setRegData(e.get("ucid"),e.get("password"));var t=S.SSCT.GetHandler("Controller","General");t.setCacheData("regUcid",e.get("ucid"),1800,!0),r.success(e,s)},this),error:function(e,s){r.error(s.msg)},quiet:s})},sdkExit:function(){S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGIN_EXIT_SDK)},getVipInfo:function(e){var r=S.SSCT.GetHandler("Model","Vip");r.fetchVipInfo({success:function(r,s){_.isUndefined(s)||_.isUndefined(s.data)?e.error&&e.error(s):e.success&&e.success(s.data)},error:function(r,s){e.error&&e.error(s)},data:{}})},notifyCp:function(e,r,s){switch(s=_.isUndefined(s)||_.isEmpty(s)?"login":s){case"login":var t=S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGIN_NOTIFY_CP,{code:e.code,msg:e.msg});break;case"logout":var t=S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGOUT_NOTIFY_CP,e)}t.success?r&&r.success&&r.success.apply(this):r&&r.error&&r.error.apply(this)},setRegData:function(e,r){sdk.PageCache.set("regInfo",JSON.stringify({ucid:e,password:r}))},getRegData:function(e){var r=sdk.PageCache.get("regInfo");e&&(r.success?e.success&&!_.isEmpty(r.data)?e.success(JSON.parse(r.data)):e.error():e.error&&e.error())},getFeatureSwitch:function(e){var r=e&&e.success?e.success:function(){},s=e&&e.error?e.error:function(){},t=S.sdkBase.request(S.sdkBase.servType.COMMON,S.sdkBase.actions.GET_FEATURE_SWITCH);t.success?r.apply(this,[t.data]):s.apply(this,[t])},logout:function(e){var r=e&&e.success?e.success:function(){},s=e&&e.error?e.error:function(){},t=S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGOUT);t.success?(this.notifyCp(null,null,"logout"),r.apply()):s.apply()},setNerverNotice:function(e,r,s){var t=ucf.Cache.get("nerver_notice_info",!0)||{};s=_.isUndefined(s)?"existAccount":s,t[e]=t[e]||{},t[e][s]=r,ucf.Cache.set("nerver_notice_info",t,0,!0)},checkNoticeInfo:function(e,r){var s=ucf.Cache.get("nerver_notice_info",!0)||{};return r=_.isUndefined(r)?"existAccount":r,s[e]=s[e]||{},s[e][r]?!0:!1},getSecQuestion:function(e,r){var s=S.SSCT.GetHandler("Model","User");return e&&0!==e?rConfig.user.accountFilter.test(e)?(s.getSecQuestion({data:{ucid:parseInt(e)},success:function(e,s){s.data?r.success&&r.success(s.data):r.error&&r.error(s.msg)},error:function(e,s){r.error&&r.error(s)}}),void 0):(r.error&&r.error("UC账号必须为数字"),void 0):(r.error&&r.error("请输入UC账号"),void 0)},validateAnswer:function(e,r){var s=S.SSCT.GetHandler("Model","User");return e.password_answer&&0!==e.password_answer.length?(s.validateAnswer({data:e,success:function(e,s){r.success&&r.success(s)},error:function(e,s){r.error&&r.error(s.msg)}}),void 0):(r.error&&r.error("请输入密保问题答案"),void 0)},resetPassword:function(e,r){var s=S.SSCT.GetHandler("Model","User");if(e.password.length<6||e.password.length>20)return r.error&&r.error("密码长度不符（6-20位）"),void 0;if(e.password.match(rConfig.user.passwordFilter))return r.error&&r.error("密码必须为字母或数字"),void 0;var t=S.global.versionCompare(S.global.version,rConfig.VERSIONS.SECURITY_VERSION);t!==!1&&t>=0&&(e.encrypt=rConfig.SECURITY_TYPE.SECURITY),s.resetPassword({data:e,success:function(s,t){var o=ucf.Cache.get("user_info_"+e.ucid,!0);o&&o.random&&ucf.Cache.set("user_info_"+e.ucid,{random:!1},0,!0),r.success&&r.success(t.data)},error:function(e,s){r.error&&r.error(s.msg)}})},updateNickname:function(e,r){var s=r.success?r.success:function(){},t=r.error?r.error:function(){},o=S.SSCT.GetHandler("Model","User"),c=this;o.off("error"),o.on("error",$.proxy(function(e,r){t.apply(this,[r])},this));var n=o.set(e);n&&o.updateNickname({success:$.proxy(function(){c.getCurUserInfo();var r=c.curUser,t=ucf.Cache.get("userBaseInfo_"+r.ucid,!0);t&&ucf.Cache.remove("userBaseInfo_"+r.ucid,!0),this.userName=e.userName,s()},this),error:$.proxy(function(e,r){t.apply(this,[r.msg])},this),data:e})},registerGuestAccount:function(e,r){var s=S.SSCT.GetHandler("Model","User");s.registerGuestAccount({data:e,success:function(e,s){r.success&&r.success(s)},error:function(e,s){r.error&&r.error(s)},quiet:!1})},bindGuestAccount:function(e,r){var s=S.SSCT.GetHandler("Model","User");s.bindGuestAccount({data:e,success:function(e,s){r.success&&r.success(s)},error:function(e,s){r.error&&r.error(s)},quiet:!1})},rechargeUPoint:function(e,r){var s=S.SSCT.GetHandler("Model","User");s.rechargeUPoint({data:e,success:function(e,s){r.success&&r.success(s.data)},error:function(e,s){r.error&&r.error(s)}})},setAutoLoginState:function(e,r){var s=S.SSCT.GetHandler("Model","User");s.setAutoLoginState({data:e,success:function(e,s){r.success&&r.success(s.data)},error:function(e,s){r.error&&r.error(s)},quiet:!0})},getAccountMobileBindInfo:function(e,r){var s=S.SSCT.GetHandler("Model","User");s.getAccountMobileBindInfo({data:{loginName:e},success:function(e,s){r.success&&r.success(s.data)},error:function(e,s){r.error&&r.error(s)},quiet:!1})},getAccountInfoByLoginName:function(e,r){var s=S.SSCT.GetHandler("Model","User");s.getAccountInfoByLoginName({data:{loginName:e},success:function(e,s){r.success&&r.success(s.data)},error:function(e,s){r.error&&r.error(s)},quiet:!0})},validMsgRetakeAccount:function(e,r){var s="";_.isEmpty(e)?(s="账号不为空",r.error(s)):e.length<2||e.length>20?(s="账号长度必须在2到20位之间",r.error(s)):rConfig.user.accountFilter.test(e)||rConfig.user.emailAccountFilter.test(e)?r.success():(s="账号格式错误",r.error(s))}});S.SSCT.Pay=Backbone.Controller.extend({getUPointBalance:function(e){var n=e&&e.success?e.success:function(){},o=e&&e.error?e.error:function(){},r=S.SSCT.GetHandler("Model","UPoint");r.fetchUPoint({success:n,error:o,data:null,quiet:!0})}});S.SSMO.Register=Backbone.Model.extend({initialize:function(){_.bindAll(this),this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.REGISTER,this.isRequest=!1},validate:function(s){if(!this.isRequest){if(_.isEmpty(s.password))return"密码不能为空，请重新输入";if(s.password.length<6||s.password.length>20)return"密码长度为6-20位";if(s.password.match(rConfig.user.passwordFilter))return"密码只能为英文字母和数字，请重新输入";if(!s.agree)return"不同意UC账号服务协议无法注册哦^-^"}this.isRequest=!1},register:function(s){this.fetch(s)},parse:function(s){return this.isRequest=!0,s.data}});S.SSMO.Secrecy=Backbone.Model.extend({initialize:function(){_.bindAll(this)},validate:function(s){console.log(s),null===s.mobile&&console.log("手机号码不为null")},validateMobile:function(s){return null===s.match(rConfig.user.mobileFilter)?{msg:"手机号码必须为数字",success:!1}:11!==s.length||"1"!==s[0]?{msg:"手机号码输入错误",success:!1}:{msg:"success",success:!0}},validateCode:function(s){return null==s||""==s?{msg:"验证码不能为空",success:!1}:{msg:"success",success:!0}},validateQuestions:function(s){return s.length<2||s.length>20?{msg:"密保问题长度必须在2~20位之间",success:!1}:{msg:"success",success:!0}},validateQuestionAnswers:function(s){return s.length<2||s.length>20?{msg:"密保答案长度必须在2~20位之间",success:!1}:{msg:"success",success:!0}},validatePassword:function(s){return s.length<6||s.length>20?{msg:"密码长度必须在6~20位之间",success:!1}:{msg:"success",success:!0}},parse:function(s){return s.data},getSecureState:function(s){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UCID_ACCOUNT_QUERYSECURESTATE,this.fetch(s)},getSecureStateDetail:function(s){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UCID_ACCOUNT_GETSECURESTATE,this.fetch(s)},sendCodeToMobile:function(s){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UCID_ACCOUNT_SENDMOBILESMSCODE,this.fetch(s)},bindMobile:function(s){var e=this.validateCode(s.data.code),t=this.validatePassword(s.data.password);e.success?t.success?(this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UCID_ACCOUNT_BINDMOBILEBYSMSCODE,this.fetch(s)):s.error(this,t):s.error(this,e)},checkIsBinded:function(s){var e=this.validateMobile(s.data.mobile);e.success?(this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UCID_ACCOUNT_CHECKISBINDED,this.fetch(s)):s.error(this,e)},saveSecurityQuestions:function(s){var e=this.validateQuestions(s.data.password_question),t=this.validateQuestionAnswers(s.data.password_answer),i=this.validatePassword(s.data.password);e.success?t.success?i.success?(this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UCID_ACCOUNT_SETPASSWORDQUESTION,this.fetch(s)):s.error(this,i):s.error(this,t):s.error(this,e)}});S.SSMO.Sso=Backbone.Model.extend({defaults:{rememberPassword:!0},initialize:function(){_.bindAll(this)},login:function(s){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.LOGIN,this.fetch(s)},getGameNotice:function(s){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.GET_GAMENOTICE,this.fetch(s)},getLoginCaptcha:function(s){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.AUTH_CAPTCHA_GETCAPTCHA,this.fetch(s)},parse:function(s){this.isRequest=!0;var e=s.data||s;return e}});S.SSMO.User=Backbone.Model.extend({initialize:function(){_.bindAll(this)},updatePass:function(s){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.CHANGE_PASSWORD,this.fetch(s)},validate:function(s){if(_.isUndefined(s.isPostDetail)){if(!_.isUndefined(s.isPostPass)){if(s.password.length<6||s.password.length>20)return"密码长度不符（6-20位）";if(s.password.match(rConfig.user.passwordFilter))return"密码必须为字母或数字";if(s.oldPassword.length<6||s.oldPassword.length>20)return"密码长度不符（6-20位）"}}else;},parse:function(s){return s.data},getSecQuestion:function(s){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.SECURITY_QUESTION,this.fetch(s)},validateAnswer:function(s){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.VALIDATE_ANSWER,this.fetch(s)},resetPassword:function(s){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.RESET_PASSWORD,this.fetch(s)},updateNickname:function(s){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UPDATE_NICKNAME,this.fetch(s)},registerGuestAccount:function(s){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.REGISTER_GUEST,this.fetch(s)},bindGuestAccount:function(s){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.ACTIVATE_GUEST,this.fetch(s)},rechargeUPoint:function(s){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.PAYCENTER_UPOINT_AUTOLOGIN,this.fetch(s)},setAutoLoginState:function(s){this.url=S.sdkBase.servType.LOGIN+"/"+S.sdkBase.actions.SET_AUTO_LOGIN_STATE,this.fetch(s)},getAccountMobileBindInfo:function(s){this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.GET_ACCOUNT_INFO,this.fetch(s)}});S.SSMO.Vip=Backbone.Model.extend({initialize:function(){_.bindAll(this),this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.VIP_INFO},fetchVipInfo:function(i){this.fetch(i)},parse:function(i){return i.data}});S.SSMO.UPoint=Backbone.Model.extend({initialize:function(){_.bindAll(this),this.url=S.sdkBase.servType.SDKSERVER+"/"+S.sdkBase.actions.CALL_SDK_SERVER+"/"+rConfig.apis.UPOINT_BALANCE},fetchUPoint:function(i){this.fetch(i)},parse:function(i){var n=i.data;return n}});S.SSVW.FindPassword=Backbone.View.extend({el:"#userContainer",events:{"click #sendCmccMessageBtn":"sendCmccMessage","click #sendUnicomMessageBtn":"sendUnicomMessage","onclick #secAnswerSubBtn":"secAnswerSubmit","onclick #newPasswordSubBtn":"newPasswordSubmit","onclick #needResetPassword":"checkedNeedResetPassword","onclick #appealRetakeBtn":"retakeMethod","onclick #forgetpasswordRetakeBtn":"retakeMethod","onclick #toAppealRetakeBtn":"toAppealRetake","onclick #toAppealRetakeByIdBtn":"toAppealRetakeByTabId","onclick #resetPassReturnGameBtn":"returnGame","onclick #accountList > .ac-item":"retakeAccount","onclick #commitAccountBtn":"commitAccount"},local:{defaultTab:"forgetpasswordRetake",tabs:["forgetpasswordRetake","appealRetake"]},initialize:function(){_.bindAll(this),this.controller=S.SSCT.GetHandler("Controller","User"),this.ssoController=S.SSCT.GetHandler("Controller","Sso"),this.generalController=S.SSCT.GetHandler("Controller","General"),this._platformVerFix(!1)},sendCmccMessage:function(){this._platformVerFix(!0);var e=this.$el.find("#sendCmccMessageBtn").attr("data");window.location.href=e,sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpwphone_b"],!0)},sendUnicomMessage:function(){this._platformVerFix(!0);var e=this.$el.find("#sendUnicomMessageBtn").attr("data");window.location.href=e,sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpwphone_b"],!0)},showMsgRetakeCon:function(e){this.$el.find("#bindedNumber").html(e),this.$el.find("#beforeMsgRetakeCon").addClass("ms-none"),this.$el.find("#msgRetakeCon").removeClass("ms-none"),this.$el.find("#fgpwRetakeWaysList").addClass("ms-none");var s=this;this.generalController.getClientConfig(this.generalController.callBackMix(function(e){if(!_.isUndefined(e)&&!_.isUndefined(e.pwdSms)){var t=e.pwdSms;_.isUndefined(t.p_notice)||s.$el.find("#findPwd_p_notice").html("<span style='color:red'>公告：</span>"+t.p_notice).removeClass("ms-none"),_.isUndefined(t.p1_flag)||(1==t.p1_flag?(s.$el.find("#findPwd_p1_text").html(t.p1_text),s.$el.find("#findPwd_p1_msg_content").html("请编写短信内容: "+t.p1_content+"发送到"+t.p1_number),s.$el.find("#sendCmccMessageBtn").attr("data","sms:"+t.p1_number+"?body="+t.p1_content)):(s.$el.find("#findPwd_p1_text").hide(),s.$el.find("#findPwd_p1_msg_content").hide(),s.$el.find("#sendCmccMessageBtn").hide())),_.isUndefined(t.p2_flag)||(1==t.p2_flag?(s.$el.find("#findPwd_p2_text").html(t.p2_text),s.$el.find("#findPwd_p2_msg_content").html("请编写短信内容: "+t.p2_content+"发送到"+t.p2_number),s.$el.find("#sendUnicomMessageBtn").attr("data","sms:"+t.p2_number+"?body="+t.p2_content)):(s.$el.find("#findPwd_p2_text").hide(),s.$el.find("#findPwd_p2_msg_content").hide(),s.$el.find("#sendUnicomMessageBtn").hide()))}},function(){}))},securityAnswer:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpwquestion_p"],!0);var e=sdk.PageCache.get("account_security_question");if(e.success&&e.data){var s=this.$el.find("#question"),t=this.$el.find("#ucAccount");s.html(e.data.question),s.attr("data-value",e.data.question),t.html(e.data.account),t.attr("data-value",e.data.account)}},secAnswerSubmit:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpwquestion_b"],!0);var e=this.$el.find("#securityAnswer").val(),s=this.$el.find("#question").attr("data-value"),t=this.$el.find("#ucAccount").attr("data-value"),n=this;this.controller.validateAnswer({ucid:parseInt(t,10),password_question:s,password_answer:e},this.controller.callBackMix(function(){sdk.PageCache.set("account_resetPassword_params",{account:t,question:s,answer:e}),sdk.Url.location.route("#!findPassword/resetPassword/"+t)},function(e){n._showErrorMsg(e)}))},resetPassword:function(e){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpwmodifypw_p"],!0),this.$el.find("#resetPassAccount").attr("data-value",e),S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!0}),document.addEventListener("backbutton",function(){S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!1})})},newPasswordSubmit:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpwmodifypwsubmit_b"],!0);var e=this.$el.find("#newPassword").val(),s=this.$el.find("#resetPassAccount").attr("data-value"),t=sdk.PageCache.get("account_resetPassword_params"),n=this;if(t.success&&t.data){var o=t.data;this.controller.resetPassword({ucid:parseInt(s,10),password_question:o.question,password_answer:o.answer,password:e},this.controller.callBackMix(function(){$("body").addClass("btnClick-none"),n.$el.find("#successBox").removeClass("ms-none")},function(e){n._showErrorMsg(e)}))}},passwordRetake:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["forgetPassword"],!0),this.$el.find("#chooseTab").on("click",function(e){var s=e.target;$(s).css("boxShadow","none")});var e;if(S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_REMOVE_WIN_EVENT,{eventName:"bridgeTopBtnClicked"}),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_WINDOW_EVENT,{eventName:"bridgeTopBtnClicked",handler:function(s){"backToLogin"==s.action&&(S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!1}),e=!0,S.Url.location.route("#!sso/login"),S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.CLEAR_HISTORY))}}),e!==!0){var s=rConfig.ACCOUNT_TYPE.UC,t=this.tabType||this.local.defaultTab;this.showRetakePageByTab(t);var n=this,o=(S.global.isThirdParty?S.global.thirdParty.name:"UC")+"账号";this.ssoController.getServerHistory(s,this.ssoController.callBackMix(function(e){var s="",t=n.$el.find("#accountList"),i=n.$el.find("#hasAccount");e.length>0?(t.removeClass("ms-none"),i.html("曾在本机登录过的"+o+"："),_.each(e,function(e){var t="";e.loginTime&&(t=e.loginTime),s+='<div class="ac-item" data-account='+e.ucid+" data-password="+e.password+">"+'<em class="em_arrow">&nbsp;</em>'+o+"："+e.ucid+"<br />最近登录时间："+t+"</div>"}),t.html(s)):i.html("！没有在本机登录过"+o)},function(e){n._showErrorMsg(e)})),sdkInfo=S.sdkBase.sdkInfo(),this.$el.find("#clientVersion").html("客户端版本号："+sdkInfo.ve)}},commitAccount:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpcommitaccount_b"],!0);var e=this.$el.find("#forgetpasswrodAccountInp").val(),s=this,t=S.SSCT.GetHandler("Controller","AccountManage");s.controller.validMsgRetakeAccount(e,{success:function(){var n=0,o="",i=s._showLoading("");t.getSecureStateDetail(["mobile","question","email"],t.callBackMix(function(t){if(s._hideLoading(i),!_.isUndefined(t)&&null!=t)if(_.isUndefined(t.mobile)||_.isUndefined(t.mobile.code)||1!=t.mobile.code||_.isUndefined(t.mobile.mobile)||11!=t.mobile.mobile.length){if(!_.isUndefined(t.question)&&!_.isUndefined(t.question.code)&&1==t.question.code&&!_.isUndefined(t.question.password_question)){n++,o+="_ques",sdk.PageCache.set("account_security_question",{account:e,question:t.question.password_question});var a=s.$el.find("#fgpwQuestionRetakeBtn");a.removeClass("ms-ni"),a.removeAttr("style"),a.find(".icon_uc").removeClass("fpque_dis_icon").addClass("fpque_icon"),a.bind("click",function(){s.fgpwQuestionRetake(t.question.password_question,e)})}}else{n++,o+="_phone";var d=s.$el.find("#fgpwPhoneRetakeBtn");d.removeClass("ms-ni"),d.removeAttr("style"),d.find(".icon_uc").removeClass("fpmob_dis_icon").addClass("fpmob_icon"),d.bind("click",function(){s.fgpwPhoneRetake(t.mobile.mobile)})}0==n&&(s.$el.find("#fgpwPhoneRetakeBtn").removeClass("ms-ni"),s.$el.find("#fgpwQuestionRetakeBtn").removeClass("ms-ni"),s.$el.find("#fgpwRetakeWaysList").find("div").removeClass("usrCtrl_sg"),s._showErrorMsg("您的账号没有进行任何绑定"),S.global.isThirdParty&&0!=S.global.thirdParty.feedback.inVisibile||s.$el.find("#fpTips").removeClass("ms-none")),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpways "+o+"_b"],!0),s._showPasswordRetakeMain()},function(e){s._hideLoading(i),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpways "+o+"_b"],!0),s._showErrorMsg(_.isUndefined(e)?"查询密保状态失败":e)}),e)},error:function(e){s._showErrorMsg(e)}})},fgpwPhoneRetake:function(e){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpbyphone_b"],!0),this.showMsgRetakeCon(e)},fgpwQuestionRetake:function(e,s){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpbyquestion_b"],!0),this.$el.find("#fgpwRetakeWaysList").addClass("ms-none"),$questionRetakeCon=this.$el.find("#questionRetakeCon"),$questionRetakeCon.removeClass("ms-none");var t=S.global.isThirdParty?S.global.thirdParty.name:"UC";$questionRetakeCon.find("#accountName").text(t);var n=$questionRetakeCon.find("#question"),o=$questionRetakeCon.find("#ucAccount");n.html(e),n.attr("data-value",e),o.html(s),o.attr("data-value",s)},fgpwMailRetake:function(e,s){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpbymail_b"],!0);var t=this;this.$el.find("#fgpwRetakeWaysList").addClass("ms-none");var n=this.$el.find("#emailRetakeCon");n.find("#emailAddress").text(e),n.find("#emailAddress").attr("data-value",s),n.removeClass("ms-none"),n.find("#backToLoginBtn").bind("click",function(){t.backToLoginAfterSendEmail()})},backToLoginAfterSendEmail:function(){var e=this.$el.find("#emailRetakeCon").find("#emailAddress").attr("data-value");this._jumtoLogin(e)},_showPasswordRetakeMain:function(){var e=this.$el.find("#fgpwRetakeEnterAccount"),s=this.$el.find("#fgpwRetakeWaysList");e.addClass("ms-none"),s.removeClass("ms-none");var t=S.global.isThirdParty?S.global.thirdParty.name:"UC";this.$el.find("#fpAccountName").text(t),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_fpways_p"],!0)},getInfoByAccount:function(e){if(!e)return null;var s=null;return _.each(this.ssoController.getServerHistories(rConfig.ACCOUNT_TYPE.UC),function(t){t.account==e&&(s=t)}),s},retakeMethod:function(e){this._platformVerFix(!1);var s=e.target,t=$(s).attr("data-retake");t&&this.showRetakePageByTab(t)},showRetakePageByTab:function(e){this.tabType=e;var s=this.local.tabs,t=this;_.each(s,function(s){s!==e&&(t.$el.find("#"+s).addClass("ms-none"),t.$el.find("."+s).parent().removeClass("on"))}),this.$el.find("#"+e).removeClass("ms-none"),this.$el.find("."+e).parent().addClass("on")},checkedNeedResetPassword:function(){var e=this.$el.find("#needResetPassword");"checked"===e.attr("data-checked")?(e.attr("data-checked",""),e.removeClass("cbbg")):(e.attr("data-checked","checked"),e.addClass("cbbg"))},toAppealRetake:function(){this.tabType="appealRetake",sdk.Url.location.route("#!findPassword/passwordRetake/appealRetake")},toAppealRetakeByTabId:function(){this.showRetakePageByTab("appealRetake")},retakeAccount:function(e){if($(e.target).hasClass("ac-item")){var s=$(e.target).attr("data-account");$(e.target).attr("data-password"),this._jumtoLogin(s)}},_jumtoLogin:function(e){!S.global.ui||S.global.ui===rConfig.SDK_UI.STANDARD||S.global.versionCompare(S.global.version,rConfig.VERSIONS.LOGIN_WIDGET_VERSION)<0?(console.log("Redirect to H5 login"),sdk.Url.location.route("#!sso/login/"+e)):S.global.ui===rConfig.SDK_UI.LOGIN_WIDGET&&(console.log("Jumto to login widget"),this.generalController.jumpToLoginWidget({uiBusiness:"loginWidget",data:{ucid:e}},{success:function(){},error:function(){sdk.Url.location.route("#!sso/login/"+e)}}))},returnGame:function(){var e=this.$el.find("#newPassword").val(),s=this.$el.find("#resetPassAccount").attr("data-value");sdk.PageCache.set("auto_login_info",{account:s,password:e,securityType:0}),S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!1}),this._jumtoLogin(s),this.generalController.clearHistory()},_showErrorMsg:function(e){this.generalController.sendClientMsg(e)},flushInpt:function(e){_.isEmpty($(e.target).val())&&$(e.target).val(""),_.isUndefined(this.noticeBar)||_.isEmpty(this.noticeBar)||sdk.common.ui.NoticeBox.hide(this.noticeBar,null,"slide")},_platformVerFix:function(e){-1!=navigator.userAgent.indexOf("Nexus 4")&&(e===!0?S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!0}):S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!1}))},_showLoading:function(e){var s=S.common.ui.NoticeBox.loading(e);return s},_hideLoading:function(e){S.common.ui.NoticeBox.hide(e,null,"remove")}});S.SSVW.Register=Backbone.View.extend({el:"#userContainer",events:{"onclick #newPassword":"flushInpt","onclick #regReturnGameBtn":"returnGame","onclick #modifyPassMask":"closeModifyPassword","onclick #cancelModifyBtn":"closeModifyPassword","onclick #doModifyBtn":"doModifyPassword","onclick #regBindBtn":"gotoBind"},isOpenModifyWindow:!1,initialize:function(){_.bindAll(this),this.$body=$("body"),this.controller=S.SSCT.GetHandler("Controller","User"),this.generalController=S.SSCT.GetHandler("Controller","General"),this.ssoController=S.SSCT.GetHandler("Controller","Sso")},regSuccess:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["registerSuccess"]});var e=this;this.controller.getRegData(this.controller.callBackMix(function(s){e.ssoController.updateLoginCount(s.ucid);var o=e.generalController.getCacheData("user_info_"+s.ucid);o&&!1===o.random&&e.$el.find("#passwordName").html("密码:"),e.$el.find("#regTitle").html("成功注册UC账号"),e.$el.find("#regMsg1").html("UC账号："+s.ucid),e.$el.find("#regUcAccount").attr("data-account",s.ucid).html(s.ucid),e.$el.find("#regPassword").attr("data-password",s.password).html(s.password)},function(){sdk.Url.back()}))},modifyPassword:function(){function e(){var e=parseInt($(window).height()),s=parseInt($(document).height());return e>s?e:s}sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_signmodifypw_b"]);var s=this;this.$el.find("#newPassword").val(""),this.$el.find("#modifyPassMask").height(e()),$(window).on("resize",function(){s.$el.find("#modifyPassMask").height(e())}),this.hideFeedBack(),this.$body.addClass("btnClick-none"),this.$el.find("#modifyPassWin").removeClass("ms-none"),this.isOpenModifyWindow=!0,S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!0}),document.addEventListener("backbutton",s.closeModifyPassword)},closeModifyPassword:function(){this.isOpenModifyWindow&&(this.$el.find("#modifyPassWin").addClass("ms-none"),this.$el.find(".btnClick-none").removeClass("btnClick-none"),this.$body.removeClass("btnClick-none"),S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!1}),document.removeEventListener("backbutton",this.closeModifyPassword),$(window).off("resize"))},doModifyPassword:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_signmodifypwok_b"]);var e=this.$el.find("#newPassword").val(),s={isPostPass:!0,oldPassword:this.$el.find("#regPassword").html(),password:e},o=this;this.controller.registerUpdatePass(s,this.controller.callBackMix(function(){o.generalController.sendClientMsg("修改成功"),o.$el.find("#passwordName").html("密码:"),o.$el.find("#regPassword").html(e),o.closeModifyPassword()},function(e){o.generalController.sendClientMsg(e)}))},returnGame:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_signgame_b"]);var e=this;this.controller.getRegData(this.controller.callBackMix(function(s){var o=ucf.Cache.get("openTestGame_"+s.ucid,!0),n=ucf.Cache.get("isAlpha_"+s.ucid,!0);return o&&o.status&&"B"==o.status?(sdk.Url.redirect("../game/game.html#!game/notOpen/"+encodeURIComponent(o.message)),void 0):n?(sdk.Url.redirect("../game/game.html#!game/validCode/false"),void 0):(e.controller.sdkExit(),void 0)},function(){sdk.Url.back()}))},gotoBind:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_signbindphone_b"]),S.Url.location.route("#!secrecy/preBind/signpage")},flushInpt:function(e){_.isEmpty($(e.target).val())&&$(e.target).val("")},_showLoading:function(){var e=S.common.ui.NoticeBox.loading();return e},_hideLoading:function(e){S.common.ui.NoticeBox.hide(e,null,"remove")},hideFeedBack:function(){this.$el.find("input").addClass("btnClick-none")}});S.SSVW.Secrecy=Backbone.View.extend({el:"#userContainer",controller:null,config:{btnLockTime:59,questionList:["我曾就读的小学校名？","刻骨铭心的6位数字？","我的心愿是？","我的爱好是？","最难忘那年那月那日？","最喜欢的一句话是？","我最关注的是什么？","最想要的物品名称？"],sourcePage:{USER:"usercenter",BIND:"ucidbindpage",REGISTER:"signpage",LOGIN:"loginpage"}},events:{"onclick #mobile, #validCode, #bindPass":"_flushInpt","onclick #toBindPageBtn":"toBindPage","onclick #doBindBtn":"doBind","onclick #resendBtn":"reSendMsg","onclick #cancelIbbBtn":"cancelIbb","onclick #keepBindBtn":"keepBind","onclick #toGameBtn":"doBindSuccess","onclick #toSetQuestionsBtn":"toSetQuestions","change  #questionList":"selQuestion","onclick #saveSecurityBtn":"saveSecurityQuestions","input #bindPass":"hideRandomPassNotice","onclick #bindPhoneTabBtn, #setQuestionTabBtn":"setBindTabHandle","onclick #pGotoSecCenterBtn,#qGotoSecCenterBtn":"redirectBtnHandle","onclick #changeNumberBtn":"changeNumberHandle"},initialize:function(){_.bindAll(this),this.$body=$("body"),this.controller=this.controller?this.controller:S.SSCT.GetHandler("Controller","AccountManage"),this.generalController=S.SSCT.GetHandler("Controller","General")},toBindPage:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_pwsphonecode_b",this.enterType]),this.hideFeedBack("#toBindPageBtn");var e=this.$el.find("#mobile").val(),n={mobile:e},i=this._showLoading(),t=this;this.controller.checkIsBinded(n,this.controller.callBackMix(function(e){t._hideLoading(i);var n=S.SSCT.GetHandler("Controller","General");n.setCacheData("mobile",$("#mobile").val(),10800,!0),null!==e.ucid?(t.beforeBoxShowed(),S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!0}),document.addEventListener("backbutton",function(){t.cancelIbb()}),t._showBindBox()):t.setRouteType("#!secrecy/bind")},function(e){t._hideLoading(i),t._showErrorMsg(e),console.log("checkIsBinded error : "+e)}))},_showBindBox:function(){this._hideLinkEffect(["cancelIbbBtn","keepBindBtn"],$("#bindPhoneCnt")[0]),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_pwsphonebind_w"]),this.$body.addClass("btnClick-none");var e=this.$el.find("#isBindBox");e.css("display","block")},doBind:function(){this.hideFeedBack("#doBindBtn");var e={code:this.$el.find("#validCode").val(),password:this.$el.find("#bindPass").val()},n=this._showLoading(),i=this;this.controller.doBindMobile(e,this.controller.callBackMix(function(){i._hideLoading(n),i.beforeBoxShowed();var e=S.SSCT.GetHandler("Controller","General"),t=i.getUserInfo().ucid,s=e.getCacheData("mobile",!0);i._showBindSuccessBox({ucid:t,mobile:s})},function(e){i._hideLoading(n),101==e.code&&i.$el.find("#bindPass").val(""),i._showErrorMsg(e.msg)}))},_showBindSuccessBox:function(e){this._hideLinkEffect("toGameBtn",this.$el.find("#bindPhoneCnt")[0]),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_pwsphoneok_w",this.enterType]),this.$el.find("#bindSuccessNoti").html("<p>UC账号：<em>"+e.ucid+"</em><br>绑定手机号：<em>"+e.mobile+"</em></p>"),this.$el.find("#bindSuccTitle").html("您已绑定成功！"),this.$el.find("#toGameBtn").data("step","changePhone"),this.$body.addClass("btnClick-none"),this.$el.find("#bindPopBox").removeClass("ms-none"),this.enterType===this.config.sourcePage.USER?this.$el.find("#toGameBtn").html("完成"):this.$el.find("#toGameBtn").html("进入游戏")},reSendMsg:function(){this.$el.find("#resendBtn").hasClass("clickAble")&&this.sendMsg()},cancelIbb:function(){S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!1}),sdk.EC.showInput(),this.hideFeedBack("#cancelIbbBtn");var e=this;setTimeout(function(){e.addFeedBack("#cancelIbbBtn")},500),this.addFeedBack("#toBindPageBtn");var n=this.$el.find("#isBindBox")[0];n.style.display="none",this.$body.removeClass("btnClick-none")},keepBind:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_pwsphonebind_b"]),this.cancelIbb(),S.SSCT.GetHandler("Controller","General"),this.setRouteType("#!secrecy/bind")},doBindSuccess:function(e){var n=$(e.target),i=n.data("step"),t=this;this.hideFeedBack("#toGameBtn"),setTimeout(function(){t.addFeedBack("#toGameBtn")},500),this.addFeedBack("#doBindBtn"),this.$el.find("#bindPopBox").addClass("ms-none"),this.$body.removeClass("btnClick-none"),"changePhone"===i?sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_pwsphoneok_game_b",this.enterType]):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_pwsquestion_game_b",this.enterType]),this.enterType===this.config.sourcePage.USER?(S.Url.location.route("#!user"),this.generalController.clearHistory()):this.toGame()},toSetQuestions:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_pwsquestion_l"]),this.setRouteType("#!secrecy/securityQuestions")},selQuestion:function(){var e=document.querySelector("#questionList"),n=e.options[e.selectedIndex],i=n.value;"-1"!=i&&""!=i&&("0"==i?this.$el.find("#passwordQuestion").val(""):this.$el.find("#passwordQuestion").val(i))},saveSecurityQuestions:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_submitQuestion_b",,this.enterType]),this.hideFeedBack("#saveSecurityBtn");var e={password_question:this.$el.find("#passwordQuestion").val(),password_answer:this.$el.find("#passwordAnswer").val(),password:this.$el.find("#questionPass").val()},n=this._showLoading(),i=this;this.controller.doSaveSecurityQuestions(e,this.controller.callBackMix(function(){i._hideLoading(n),i.beforeBoxShowed();var e=i.getUserInfo().ucid;i._showQuestionBindSuccessBox({ucid:e})},function(e){i._hideLoading(n),101==e.code&&i.$el.find("#questionPass").val(""),i._showErrorMsg(e.msg)}))},_showQuestionBindSuccessBox:function(e){this._hideLinkEffect("toGameBtn",$("#setQuestionCnt")[0]),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_pwsquestion_w",this.enterType]),this.$el.find("#bindSuccessNoti").html("<p>UC账号<em>"+e.ucid+"</span>已成功设置密保问题。</em></p>"),this.$el.find("#bindSuccTitle").html("您已设置成功！"),this.$el.find("#toGameBtn").data("step","changeQuestion"),this.$body.addClass("btnClick-none"),this.$el.find("#bindPopBox").removeClass("ms-none"),this.enterType===this.config.sourcePage.USER?this.$el.find("#toGameBtn").html("完成"):this.$el.find("#toGameBtn").html("进入游戏")},_initPopbox:function(){this.$el.find("#bindPopBox").length<=0&&this.$el.append($("#bindPopBoxTempl").html())},initBackBtnEvent:function(){var e=this;S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_REMOVE_WIN_EVENT,{eventName:"bridgeTopBtnClicked"}),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_WINDOW_EVENT,{eventName:"bridgeTopBtnClicked",handler:function(n){"sdBackGame"==n.action&&e.toGame(),"backToUsercenter"==n.action&&(e._isStop=!0,e._retryLoadingElem&&(e._hideLoading(e._retryLoadingElem),e._retryLoadingElem=null),S.Url.back())}})},toGame:function(){var e=this.getUserInfo().ucid,n=ucf.Cache.get("openTestGame_"+e,!0),i=ucf.Cache.get("isAlpha_"+e,!0);n&&n.status&&"B"==n.status?sdk.Url.redirect("../game/game.html#!game/notOpen/"+encodeURIComponent(n.message)):i?sdk.Url.redirect("../game/game.html#!game/validCode/false"):(S.Log.pageClose(),S.SSCT.GetHandler("Controller","User").sdkExit())},_renderPhoneBindSuccess:function(e,n){this.$el.find("#pBindChangeInfo").html("<b>UC账号："+e+"</b><br /><b>已绑定手机号码："+n+"</b>"),this.$el.find("#pBingChangeNoti").html('<h6 class="f-gray">您已绑定手机，可通过手机号找回账号、密码，还可直接使用手机号登录游戏。</h6><p class="p_fs f14">如需修改手机号，请前往账户中心设置。</p>'),this.$el.find("#pGotoSecCenterBtn").data("type","updateMobile")},_renderGotoPhoneBinding:function(){this.$el.find("#pBindChangeInfo").addClass("ms-none"),this.$el.find("#pBingChangeNoti").html('<h6 class="f-gray">如需继续提高账号安全，可前往账户中心，把您的UC账号和手机进行绑定。</h6>'),this.$el.find("#pGotoSecCenterBtn").html("绑定手机号码").data("type","setMobile")},_renderQuestionBindSuccess:function(e){this.$el.find("#qBingChangeNoti").html('<h6 class="f-gray">您已为UC账号 <em>'+e+"</em>  设置密保问题，忘记密码时可通过此方式找回密码。</h6>"+'<p class="p_fs f14">如需修改密保问题，请前往账户中心设置。</p>'),this.$el.find("#qGotoSecCenterBtn").data("type","updateQuestion")},_renderGotoQuestionBinding:function(){this.$el.find("#qBingChangeNoti").html('<h6 class="f-gray">如需继续提高账号安全，可前往账户中心，为您的UC账号设置密保问题。</h6>'),this.$el.find("#qGotoSecCenterBtn").html("设置密保问题").data("type","setQuestion")},_renderBindingFail:function(){this.$el.html(this.$el.find("#screcyPageTempl").html()),this.$el.find("#secrecy_con").html('<section class="ui-maincontainer"><center class="gr-mt20"><h6 class="f-gray">暂时无法获取您的账号安全情况<h6></center></section>')},setPageState:function(e,n){var i,t;if(ucid=this.getUserInfo().ucid,"mobile"===e||"question"===e||"both"===e){switch(this.$el.html(template.render("screcyPageTempl")),i=this.$el.find("#bindPhoneCnt"),t=this.$el.find("#setQuestionCnt"),e){case"mobile":i.html(template.render("phoneBindingChangeTempl")),t.html(template.render("questionBindingChangeTempl")),this._renderPhoneBindSuccess(ucid,n),this._renderGotoQuestionBinding();break;case"question":i.html(template.render("phoneBindingChangeTempl")),t.html(template.render("questionBindingChangeTempl")),this._renderGotoPhoneBinding(),this._renderQuestionBindSuccess(ucid);break;case"both":i.html(template.render("phoneBindingChangeTempl")),t.html(template.render("questionBindingChangeTempl")),this._renderPhoneBindSuccess(ucid,n),this._renderQuestionBindSuccess(ucid);break;case"none":}("mobile"==e||"question"==e||"both"==e)&&S.global.isThirdParty&&this.$el.find("#phoneBindChangeAcLb").html(S.global.thirdParty.name+"账号:"+i.html())}},setBindTabHandle:function(e){var n=$(e.target),i=n.data("type");i&&this.setBindTab(i)},redirectBtnHandle:function(e){var n,i=$(e.target).data("type");if(i){switch(i){case"setQuestion":n=eConfig.setQuestion;break;case"setMobile":n=eConfig.setMobile;break;case"updateQuestion":n=eConfig.updateQuestion;break;case"updateMobile":n=eConfig.updateMobile}n&&(this.businessLoging(i),sdk.Url.redirect(n))}},businessLoging:function(e){var n;if(e){switch(e){case"setMobile":n=["h5_pwsphone_open_b"];break;case"updateMobile":n=["h5_resetPhoneNum_b"];break;case"setQuestion":n=["h5_pwsquestion_open_b"];break;case"updateQuestion":n=["h5_resetQuestion_b"]}n&&sdk.Log.click(sdk.Log.businesses.PAGE_USER,n)}},setBindTab:function(e){function n(){t.parent().addClass("on"),o.removeClass("ms-none").addClass("pagefocus"),s.parent().removeClass("on"),a.addClass("ms-none").removeClass("pagefocus")}function i(){t.parent().removeClass("on"),o.addClass("ms-none").removeClass("pagefocus"),s.parent().addClass("on"),a.removeClass("ms-none").addClass("pagefocus")}var t=this.$el.find("#bindPhoneTabBtn"),s=this.$el.find("#setQuestionTabBtn"),o=this.$el.find("#bindPhoneCnt"),a=this.$el.find("#setQuestionCnt");switch(this._bindTabType=e,e){case"question":i(),this._pageType="question";break;case"mobile":n(),this._pageType="mobile"}var d=$(".pagefocus .tabPage",this.el);if($(".pagefocus .tabPage",this.el).length>0){var l;switch(d.data("page")){case"bind":l=["bind"];break;case"preBind":l=["preBind",this.enterType];break;case"question":l=["preBind_question",this.enterType]}l&&(S.Log.pageClose(),S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:l}))}},_getSecStateRetry:function(e){function n(){return t._isStop?(t._isStop=!1,t._hideLoading(s),void 0):(i.getSecureStateDetail(["mobile","question"],i.callBackMix(function(n){if(1===n.mobile.code&&(1===n.question.code||126===n.question.code)){var i;return _.isEmpty(n.mobile.mobile)&&_.isEmpty(n.question.password_question)?i="none":_.isEmpty(n.mobile.mobile)||_.isEmpty(n.question.password_question)?_.isEmpty(n.question.password_question)?_.isEmpty(n.mobile.mobile)||(i="mobile"):i="question":i="both",t._hideLoading(s),e.success&&e.success(i,n),void 0}t._hideLoading(s),e.error&&e.error()},function(){t._hideLoading(s),e.error&&e.error()})),void 0)}var i=S.SSCT.GetHandler("Controller","AccountManage"),t=this,s=t._showLoading();t._retryLoadingElem=s,n.call(this)},_showLoading:function(){var e=S.common.ui.NoticeBox.loading();return e},_hideLoading:function(e){S.common.ui.NoticeBox.hide(e,null,"remove")},preBind:function(e,n){function i(n,i,t){this.enterType=e,"usercenter"===this.enterType&&this.setPageState(n,i),this.preBindRender(e)}S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["preBind",e]});var t=sdk.PageCache.get("risk"),s=sdk.PageCache.get("secrecy_binding_mobile"),o=this,a=t.success?t.data:void 0,n=n||"mobile";sdk.PageCache.del("risk"),sdk.PageCache.del("secrecy_binding_mobile"),this._isStop=!1,"usercenter"!==e||t.success&&t.data&&"fail"!==t.data?(this.$el.find("#preBindCon").removeClass("ms-none"),i.call(this,a,s&&s.success?s.data:"",n)):this._getSecStateRetry({success:function(e,t){o.$el.find("#preBindCon").removeClass("ms-none"),i.call(o,e,t.mobile.mobile,n)},error:function(){o.$el.find("#preBindCon").removeClass("ms-none"),o._renderBindingFail()}}),this.initBackBtnEvent()},preBindRender:function(e){var n=this.$el.find("#bindNoticeMsg");"pwFalse"==e?n.html("我们发现您曾经出现密码错误，为了让您在忘记密码后能顺利找回，建议："):"paid"==e?n.html("您已完成支付，如果丢失账号、密码，则可能造成损失，因此我们强烈建议您："):"loginpage"==e?n.html("您已多次使用本账号进行游戏，为避免丢失账号、密码后可能造成的损失，建议："):"usercenter"==e&&n.html("数据显示，80%以上丢账号未能及时找回的玩家，都是因为未绑定手机所致。"),_.isUndefined($("#mobile").val())||""==$("#mobile").val()||this.$el.find("#mobile").val("")},bind:function(){S.Log.pageClose(),S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["bind"]});var e=S.SSCT.GetHandler("Controller","General"),n=e.getCacheData("mobile",!0),i=this.getUserInfo().ucid,t=this.$el.find("#validCode"),s=this.$el.find("#bindPass");if(_.isUndefined(t.val())||""==t.val()||t.val(""),_.isUndefined(s.val())||""==s.val()||s.val(""),this.getUserInfo().isRandomPassword)s.val(this.getUserInfo().randomPassword),this.showRandomPassNotice();else{var o=S.SSCT.GetHandler("Controller","General").getCacheData("user_info_"+i,!0);o&&o.random&&(s.val(o.password),this.showRandomPassNotice())}this._initPopbox.call(this);var a="UC账号:";S.global.isThirdParty&&(a=S.global.thirdParty.name+"账号:"),this.$el.find("#bindInfo").html(template.render("bindingInfoTempl",{ucid:i,mobile:n,accountName:a})),this.sendMsg()},securityQuestions:function(e){this.enterType=e,S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["preBind_question",this.enterType]});var n=this.getUserInfo().ucid;"usercenter"===e?this.$el.find("#setQuestionNoti").html("设置密保问题后，忘记密码可通过此方式找回密码。"):this.$el.find("#setQuestionNoti").html("您还可以设置密保问题，忘记密码时，可通过此方式找回。"),this.initQuestionList(),this._initPopbox.call(this),this.$el.find("#passwordQuestion").val(this.config.questionList[0]);var i=this.$el.find("#passwordAnswer");if(_.isUndefined(i.val())||""==i.val()||i.val(""),this.getUserInfo().isRandomPassword)this.$el.find("#questionPass").val(this.getUserInfo().randomPassword);else{var t=S.SSCT.GetHandler("Controller","General").getCacheData("user_info_"+n,!0);t&&t.random&&this.$el.find("#questionPass").val(t.password)}},sendMsg:function(){this.btnCountDown();var e=S.SSCT.GetHandler("Controller","General"),n=e.getCacheData("mobile",!0),i={mobile:n},t=this;this.controller.sendCode2Mobile(i,this.controller.callBackMix(null,function(e){t.cancelBtnCountDown(),t._showErrorMsg("发送验证码失败: "+e)}))},btnCountDown:function(){"undefined"!=typeof secrecyTimeId&&null!=secrecyTimeId&&(clearInterval(secrecyTimeId),secrecyTimeId=null);var e=this.config.btnLockTime,n=this,i=this.$el.find("#resendBtn");i.val(e+" 重新获取"),i.removeClass("clickAble"),secrecyTimeId=setInterval(function(){--e<0?n.cancelBtnCountDown():i.val(e+" 重新获取")},1e3)},cancelBtnCountDown:function(){clearInterval(secrecyTimeId),secrecyTimeId=null;var e=this.$el.find("#resendBtn");e.val("重新获取"),e.addClass("clickAble")},_flushInpt:function(e){_.isEmpty($(e.target).val())&&$(e.target).val(""),this._hideErrorMsg()},getUserInfo:function(){var e=e?e:S.SSCT.GetHandler("Controller","User"),n=this,i=e.getCurUser();return(_.isEmpty(i)||i=={})&&e.getCurUserInfo(e.callBackMix(function(e){i=e},function(){n._showErrorMsg("获取用户信息失败")})),i},initQuestionList:function(){var e='<option value="-1">请选择密保问题</option>';this.config.questionList.map(function(n){e+="<option value="+n+">"+n+"</option>"}),e+='<option value="0">自定义问题</option>',this.$el.find("#questionList").html(e)},beforeBoxShowed:function(){var e=this;this.$el.find("#modifyPassMask").height($(window).height()+150),$(window).on("resize",function(){e.$el.find("#modifyPassMask").height($(window).height()+150)}),_.delay(function(){sdk.EC.hideInput()},50)},changeNumberHandle:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_changeNum_b"]),this.setRouteType("#!secrecy/preBind")},setRouteType:function(e){var n=this.enterType||"";this.$el.find("#bindPhoneCnt"),this.$el.find("#setQuestionCnt"),S.Url.location.route(e+"/"+n)},_showErrorMsg:function(e){var n=S.SSCT.GetHandler("Controller","General");n.sendClientMsg(e)},_hideErrorMsg:function(e){e=_.isUndefined(e)||_.isEmpty(e)?"slide":e,_.isUndefined(this.noticeBar)||_.isEmpty(this.noticeBar)||("remove"==e?S.common.ui.NoticeBox.hide(this.noticeBar,null,"remove"):S.common.ui.NoticeBox.hide(this.noticeBar,null,"slide"))},_showLoading:function(){var e=S.common.ui.NoticeBox.loading();return e},_hideLoading:function(e){S.common.ui.NoticeBox.hide(e,null,"remove")},hideFeedBack:function(e){$(e).addClass("btnClick-none")},addFeedBack:function(e){$(e).removeClass("btnClick-none")},hideRandomPassNotice:function(){this.$el.find("#randomPassNotice").addClass("ms-vshid")},showRandomPassNotice:function(){this.$el.find("#randomPassNotice").removeClass("ms-vshid")}});S.SSVW.Sso=Backbone.View.extend({el:"#userContainer",events:{"onclick #username,#password,#newPassword,#captchaInput":"_flushInpt","input #password":"_passwordValueChange","onclick #loginBut":"loginSubmit","onclick #registerBut":"register","onclick #forgetPassBtn":"forgetPassword","onclick #mobileBindingBtn":"bindMobile","onclick #registerReturnGameBtn":"returnGameAndLogin","onclick #gameLoginReturnGameBtn":"returnGameAndLogin","onclick #gameLoginBtn":"gotoGameLogin","onclick #backBtn":"goBack","onclick #modifyAndLoginBtn":"loginPageModifyAndLogin","onclick #forceModifyAndLoginBtn":"forceModifyAndLogin","onclick #bindModifyAndLoginBtn":"bindModifyAndLogin","onclick #useUCAccountLogin":"useUCAccountLogin","onclick #isNerverNotice":"checkNerverNotice","change #loginHistory":"selectHis","onclick #updatePassBtn":"_setUpdatePassParam","onclick #cancelLogin":"cancelUCAccountLogin","onclick #neverUpdateBtn":"neverUpdatePass","onclick #cancelModify":"cancelModify","onclick #agreementBtn":"gotoAgreement","onclick #loginHistory":"logHist","onclick #closeNotice":"closeNotice","onclick #noticeBtn":"showNotice","onclick #modifyPassBtn":"modifyPassword","onclick #regSuccessContent":"hideModify","onclick #checkboxArea":"setAccAutoLogin","onclick #captchaBtn":"captchaLoginSubmit","onclick #captchaRefreshBtn":"refreshCaptcha"},accountType:0,randomPwd:!0,noticeId:"",model:{},resp:{},loginHist:[],loginCount:0,localConfig:{LOGIN_COUNT:15,SECURITY_TYPE:{UNSECURITY:0,SECURITY:1}},loginLoadingEl:{},loginOptions:{},isNeedCaptcha:!1,isGettingCaptcha:!1,captchaForReg:!1,thirdParty:{name:"",accountName:"",loginLogo:""},checkedLastLoginTimeAccounts:"",initialize:function(){console.log(Math.floor(3*Math.random())),_.bindAll(this),this.controller=S.SSCT.GetHandler("Controller","Sso"),this.userController=S.SSCT.GetHandler("Controller","User"),this.generalController=S.SSCT.GetHandler("Controller","General"),this.accountType=this.controller.CONFIG.ACCOUNT_TYPE.LOGIN,this.$body=$("body");var e=S.global.versionCompare(S.global.version,rConfig.VERSIONS.SECURITY_VERSION);e!==!1&&e>=0?this.$body.data("ctrl","true"):this.$body.data("ctrl",""),this.accountName=S.global.isThirdParty?S.global.thirdParty.name:"UC"},closeNotice:function(){this.$body.removeClass("btnClick-none"),this.$el.find("#notice").addClass("ms-ni"),this._showLinkEffect()},showNotice:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_LoginNotice_l",this.noticeId]),this.$body.addClass("btnClick-none"),this.$el.find("#notice").removeClass("ms-ni"),this._hideLinkEffect("closeNotice")},login:function(e){-1!=navigator.userAgent.indexOf("Nexus 4")&&S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!1}),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["sso"],!0),sdk.PageCache.del("auto_login_info"),this.accountType=this.controller.CONFIG.ACCOUNT_TYPE.LOGIN,this.controller.clearHistFlag();var s=e,i=sdk.PageCache.get("auto_login_info"),o=this,t=this.controller.getLoginConfig(),n=t.allowGameLogin,a=t.gameAccountTitle,c=t.isAutoLogin;this.displayContentByChannel(),c===!1?this.$el.find("#iconCheckbox").removeClass("on"):this.$el.find("#iconCheckbox").addClass("on"),a=_.isUndefined(a)||null===a||0===a.length?rConfig.user.defaultGameName:a;var d=ucf.Cache.get("game_notice",!0)||{},r=this.$el.find("#noticeBtn"),l=this.$el.find("#noticeTtl"),h=this.$el.find("#noticeWrapper");_.isUndefined(d.content)||(r.html(d.content).removeClass("gr-vshid"),l.html(d.content),h.html(d.contentDetail),this.noticeId=d.msgId,sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_LoginNotice_p",d.msgId])),this.controller.getGameNotice({success:function(e){_.isUndefined(e)||(_.isUndefined(d.content)||0==parseInt(e.priority))&&(r.html(e.content).removeClass("gr-vshid"),l.html(e.content),h.html(e.contentDetail),o.noticeId=e.msgId,sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_LoginNotice_p",e.msgId]))},error:function(){}});var g=this.$el.find("#gameLoginBtn");g.html(a+"老账号登录"),this.$el.find("#showHistory").removeClass("ms-ni"),n===!0&&S.global.isThirdParty!==!0&&g.removeClass("ms-none"),this.versionFixing(),this.$body.removeClass("btnClick-none"),this.$el.find("#registerBut").val("一键注册").data("type","login"),this.$el.find("#forgetPassBtn").removeClass("ms-ni"),this.$el.find("#gameLoginBottom").addClass("ms-ni"),this.$el.find("#normalLoginBottom").removeClass("ms-ni"),i&&i.success&&i.data?this._setHistory(i.data.account,i.data.password,i.data.securityType):s?this._setHistory(s):this._setHistory(),this._restoreRegSuccWin()},gameLogin:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["oldAccountLogin"]}),this.versionFixing();var e=this.controller.getLoginConfig(),s=e.isAutoLogin;s===!1?this.$el.find("#iconCheckbox").removeClass("on"):this.$el.find("#iconCheckbox").addClass("on");var i=e.gameAccountTitle;i=_.isUndefined(i)||null===i||0===i.length?rConfig.user.defaultGameName:i,this.setUsername(""),this.setLastLoginTime(-1),this.setPassword(""),this.$body.removeClass("btnClick-none"),this.accountType=this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN,this.$el.find("#loginTitleTabs").html('<a class="item">'+i+'老账号</a><p class="btnBox"><a href="javascript:;" id="backBtn" class="fl btn btn_dark back_btn">'+this.accountName+"账号</a></p>"),this.$el.find("#username").attr("placeholder",i),this.$el.find("#registerBut").val("注册"+this.accountName+"账号").data("type","gameLogin"),this.$el.find("#forgetPassBtn").addClass("ms-ni"),this._setHistory(),this.$el.find("#normalLoginBottom").addClass("ms-ni"),this.$el.find("#gameLoginBottom").removeClass("ms-ni"),this.$el.find("#showHistory").addClass("ms-ni");var o=sdk.PageCache.get("login_param");if(o.success&&o.data){var t=o.data.account,n=o.data.password,a=o.data.randomPassword;a?this._setRegSuccPopup(t,a,!0,!1):this._setRegSuccPopup(t,n,!0,!0)}this._restoreRegSuccWin()},versionFixing:function(){var e=S.global.versionCompare(S.global.version,rConfig.VERSIONS.AUTO_LOGIN_VERSION);e!==!1&&e>=0?this.$el.find("#checkboxArea").removeClass("ms-ni"):this.$el.find("#checkboxArea").addClass("ms-ni");var s=S.global.versionCompare(S.global.version,rConfig.VERSIONS.LOGIN_WIDGET_VERSION);s!==!1&&s>=0?(this.$el.find("#agreementLinkCon").addClass("ms-none"),this.$el.find("#regAgree").removeClass("ms-none"),this.$el.find("#registerReturnGameBtn").val("立即登录"),this.$el.find("#gameLoginReturnGameBtn").val("立即登录")):(this.$el.find("#agreementLinkCon").removeClass("ms-none"),this.$el.find("#regAgree").addClass("ms-none"),this.$el.find("#registerReturnGameBtn").val("进入游戏"),this.$el.find("#gameLoginReturnGameBtn").val("进入游戏"))},loginSubmit:function(){this.accountType===this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN?sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_oldidlogin_b"]):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_login_b"]);var e=this,s="您正在登录的"+this.accountName+"账号已与游戏账号绑定，角色信息完全一样",i=this.accountType,o=this.$el.find("#username").val(),t=this.$el.find("#password").getInp(),n=this.$el.find("#password").isModify(),a=this.$el.find("#iconCheckbox").hasClass("on"),c=this.getLastLoginTime(o);securityType=n?this.localConfig.SECURITY_TYPE.UNSECURITY:this.localConfig.SECURITY_TYPE.SECURITY,vc=S.global.versionCompare(S.global.version,rConfig.VERSIONS.SECURITY_VERSION),isSecurity=!1,this.accountType===this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN&&(s="您正在使用"+this.accountName+"账号登录，此账号还能在所有UC和九游产品中使用"),vc!==!1&&vc>=0&&securityType===this.localConfig.SECURITY_TYPE.SECURITY&&(isSecurity=!0),this.controller.validLoginData(o,t,i,{isSecurity:isSecurity},this.controller.callBackMix(function(o,t){if(e.loginOptions={loadingMsg:s,account:o,password:t,accountType:i,rememberPassword:!0,isAutoLogin:a,securityType:securityType},e._isLoginStateInvalid(o,c))return e._showErrorMsg("账号登录信息已过期，请重新输入密码"),e.setPassword(""),void 0;var n=sdk.PageCache.get("isCheckCaptcha_"+o);return n.success&&1===n.data?(e._showCaptchaPopup(),void 0):(e._loginSubmitInner(),void 0)},function(s){if(105==s.code||102==s.code){e.$el.find("#password").setInp("");var i=ucf.Cache.get("wrong_password_ucids",!0)||{},o=e.$el.find("#username").val();i[o]=1,ucf.Cache.set("wrong_password_ucids",i,0,!0)}e._showErrorMsg(s.msg)}))},captchaLoginSubmit:function(){var e=this.$el.find("#captchaInput"),s=e.val();s=s.replace(/^\s+/g,"").replace(/\s+$/g,""),_.isEmpty(s)?this._showErrorMsg("请输入验证码"):(this.loginOptions.captcha=s,this.captchaForReg?this._loginSubmitForRegInner():this._loginSubmitInner())},_loginSubmitForRegInner:function(){var e=this,s=e.loginOptions.account,i=e.loginOptions.password,o=e.loginOptions.isAutoLogin,t={account:s,password:i,isAutoLogin:o},n=e._showLoading();_.isUndefined(this.loginOptions.captcha)||_.isEmpty(this.loginOptions.captcha)||(t.captcha=e.loginOptions.captcha),e.controller.loginSubmit(t,!1,e.controller.callBackMix(function(s){e._hideLoading(n),ucf.Cache.set("openTestGame_"+t,s.get("openTestGame"),3600,!0),ucf.Cache.set("isAlpha_"+t,s.get("isAlpha"),3600,!0);var i=s.get("isCheckCaptcha");1==i?sdk.PageCache.set("isCheckCaptcha_"+t,i):sdk.PageCache.del("isCheckCaptcha_"+t),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ucidbindgame_b"]);var o=e.$el.find("#ucAccount"),t=o.attr("data-value"),a=o.attr("data-acType");e.doLoginCheck(a,t),sdk.PageCache.del("login_param")},function(i,o){e._hideLoading(n),_.isUndefined(o.data)||_.isUndefined(o.data.isCheckCaptcha)||1!=o.data.isCheckCaptcha?sdk.PageCache.del("isCheckCaptcha_"+s):sdk.PageCache.set("isCheckCaptcha_"+s,o.data.isCheckCaptcha);var t="登录失败";t=13==o.code?"请输入验证码":o.msg||t,12==o.code&&e.refreshCaptcha(),e._showErrorMsg(t)}))},_loginSubmitInner:function(){var e=this,s=e.loginOptions.loadingMsg,i=e.loginOptions.account,o=e.loginOptions.password,t=e.loginOptions.accountType,n=(e.loginOptions.rememberPassword,e.loginOptions.isAutoLogin),a=e.loginOptions.securityType,c={account:i,password:o,accountType:t,rememberPassword:!0,isAutoLogin:n,securityType:a};_.isUndefined(this.loginOptions.captcha)||_.isEmpty(this.loginOptions.captcha)||(c.captcha=e.loginOptions.captcha),this.loginLoadingEl=e._showLoading(s),this.controller.loginSubmit(c,!0,e.controller.callBackMix(function(s,n){e._hideCaptchaPopup();var a,c,d;ucf.Cache.set("openTestGame_"+s.get("ucid"),s.get("openTestGame"),86400,!0),ucf.Cache.set("isAlpha_"+s.get("ucid"),s.get("isAlpha"),86400,!0);var r=s.get("isCheckCaptcha");1==r?sdk.PageCache.set("isCheckCaptcha_"+i,r):sdk.PageCache.del("isCheckCaptcha_"+i),e.isNeedCaptcha&&sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_captcha_login_success"]),e.$el.find("input").addClass("btnClick-none"),e.userController.getCurUserInfo(e.userController.callBackMix(function(s){d=s,a=s.ucid,c=e.generalController.getCacheData("user_info_"+s.ucid,!0);var i=s.password||s.randomPassword;c&&c.random&&i!=c.password&&e.generalController.setCacheData("user_info_"+s.ucid,{random:!1},0,!0)}));var l=ucf.Cache.get("wrong_password_ucids",!0);if(a&&l&&l[i])return delete l[i],ucf.Cache.set("wrong_password_ucids",l,0,!0),e.controller.updateLoginCount(i),e.toSecrecyPage(t,i,function(){e.doLoginSuccess(s,n)},1,e.loginLoadingEl),void 0;var h,g=!0;if(e.loginCount=e.controller.getLoginCount(a),c=e.generalController.getCacheData("user_info_"+a,!0),c&&(d.isRandomPassword=c.random,d.randomPassword=d.isRandomPassword?c.password:d.randomPassword),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_randomPw_i"]),t==e.controller.CONFIG.ACCOUNT_TYPE.LOGIN&&!0===d.isRandomPassword)e._hideLoading(e.loginLoadingEl),e.controller.updateLoginCount(d.ucid),e.loginCount<=3?e.doLoginCheck(t,i):e._showUpdateRandomPassBox({accountType:t,account:d.ucid,randomPassword:d.randomPassword,isUCLogin:!0});else if(c||(isNaN(o)||8!=o.toString().length)&&(11!=o.toString().length||"UCX"!=o.substr(0,3)||isNaN(o.substr(3,o.toString().length-3))))e.doLoginSuccess(s,n);else{sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_speciallyPw"]);var u,m,p=e.loginHist,f=p.length;if(0!==f&&!_.isUndefined(p[0]))for(var C=0;f>C;C++)if(u=p[C],u.account==i){m=u.lastLoginTime;var k=(new Date).valueOf();h=(parseInt(k)-parseInt(m))/864e5,2>h&&(g=!1);break}h&&g?(e._hideLoading(e.loginLoadingEl),e.model=s,e.resp=n,sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_overtimePw_w"]),e._showPopBox(template.render("forceUpdateRandomPassBoxTempl"),function(){var s=e.$el.find("#updateHint");s.html("您已"+Math.floor(h)+"天未登陆本账号，为了您的账号安全，请重新输入密码"),s.attr({account:i,accountType:t,password:o})})):e.doLoginSuccess(s,n)}},function(s,o){e._hideLoading(e.loginLoadingEl),_.isUndefined(o.data)||_.isUndefined(o.data.isCheckCaptcha)||1!=o.data.isCheckCaptcha?sdk.PageCache.del("isCheckCaptcha_"+i):sdk.PageCache.set("isCheckCaptcha_"+i,o.data.isCheckCaptcha);var t="";if(t=13==o.code?"请输入验证码":o.msg,e._showErrorMsg(t),12==o.code||13==o.code||-3==o.code&&-5==esp.code&&e.isNeedCaptcha===!0)12==o.code?e.refreshCaptcha():13==o.code&&e._showCaptchaPopup();else if(e._hideCaptchaPopup(),101==o.code){e.$el.find("#password").setInp("");var n=ucf.Cache.get("wrong_password_ucids",!0)||{},a=s.get("account");n[a]=1,ucf.Cache.set("wrong_password_ucids",n,0,!0)}}))},doLoginSuccess:function(e){var s=e.get("account"),i=e.get("password"),o=e.get("accountType"),t=(e.get("rememberPassword"),this),n={};this.userController.getCurUserInfo(this.userController.callBackMix(function(e){n=e},function(){t.userController.sdkExit()}));var a=this.generalController.getCacheData("user_info_"+n.ucid,!0);a&&(n.isRandomPassword=a.random,n.randomPassword=n.isRandomPassword?a.password:n.randomPassword);var c=!(!1===n.isRandomPassword||0===n.randomPassword.length),d=ucf.Cache.get("login_binding_info",!0)||{};if(o===this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN&&d[s]!==!0){d[s]=!0,ucf.Cache.set("login_binding_info",d,0,!0);var r=n.ucid,l=n.randomPassword;c?this.controller.validSecrecy(o,s,this.controller.callBackMix(function(){t._hideLoading(t.loginLoadingEl),sdk.PageCache.set("login_param",{accountType:t.controller.CONFIG.ACCOUNT_TYPE.LOGIN,account:r,password:i,randomPassword:l}),t._setRegSuccPopup(r,l,!0)},function(){t._hideLoading(t.loginLoadingEl),t.userController.checkNoticeInfo(n.ucid,"updatePassword")?t.doLoginCheck(o,s):t._showUpdateRandomPassBox({accountType:t.controller.CONFIG.ACCOUNT_TYPE.LOGIN,account:n.ucid,randomPassword:n.randomPassword})})):this.existUCAccount()}else o===this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN?this.existUCAccount(o,n.ucid):(t._hideLoading(t.loginLoadingEl),this.controller.updateLoginCount(n.ucid),this.doLoginCheck(o,n.ucid))},register:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_b"]),S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["register"]});var e=this._randomPassword(),s=this._showLoading(),i=this;this.userController.register({password:e,isRandomPassword:!0,agree:!0},this.userController.callBackMix(function(o){function t(){i._hideLoading(s),i._setRegSuccPopup(o.get("ucid"),e,!1),"gameLogin"==i.$el.find("#registerBut").data("type")?sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_w_GameAccount"]):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_w_UCAccount"])}function n(){i.controller.loginSubmit(a,!0,i.controller.callBackMix(function(o){i._hideLoading(s),ucf.Cache.set("openTestGame_"+o.get("ucid"),o.get("openTestGame"),3600,!0),ucf.Cache.set("isAlpha_"+o.get("ucid"),o.get("isAlpha"),3600,!0),"gameLogin"==i.$el.find("#registerBut").data("type")?sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_w_GameAccount"]):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_w_UCAccount"]),i._setRegSuccPopup(o.get("ucid"),e,!1)},function(e,o){i._hideLoading(s),i._showErrorMsg(o.msg||"登录失败")}))}i.generalController.setCacheData("user_info_"+o.get("ucid"),{random:!0,password:e},0,!0);var a={account:o.get("ucid"),isAutoLogin:!0,password:e};S.global.versionCompare(S.global.version,rConfig.VERSIONS.LOGIN_WIDGET_VERSION)>=0?(i.$el.find("#registerReturnGameBtn").data("regType","registerOnly"),t.call(i)):(i.$el.find("#registerReturnGameBtn").data("regType","registerAndLogin"),n.call(i))},_.bind(function(e){i._hideLoading(s),i.generalController.sendClientMsg(e)},this)),!0)},doLoginCheck:function(e,s,i){function o(){if(a&&a.status&&"B"==a.status)return sdk.Url.redirect("../game/game.html#!game/notOpen/"+encodeURIComponent(a.message)),void 0;if(c)sdk.Url.redirect("../game/game.html#!game/validCode/false");else{if(i)return i.apply(t),void 0;t.userController.sdkExit()}}var t=this,n=this.userController.getCurUser().ucid,a=ucf.Cache.get("openTestGame_"+n,!0),c=ucf.Cache.get("isAlpha_"+n,!0),d=this.controller.getLoginCount(n);e==this.controller.CONFIG.ACCOUNT_TYPE.LOGIN&&d==this.localConfig.LOGIN_COUNT?this.toSecrecyPage(e,s,function(){o()}):o()},bindMobile:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ucidbindphone_b"]),sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["bindSecrecyMobile"]),sdk.Url.location.route("#!secrecy/preBind/ucidbindpage")},returnGame:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ucidbindgame_b"]);var e=this.$el.find("#ucAccount"),s=e.attr("data-value"),i=e.attr("data-acType");this.doLoginCheck(i,s),sdk.PageCache.del("login_param")},firstGameLogin:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["firstGameLogin"]});var e=sdk.PageCache.get("login_param");if(e.success&&e.data){var s=e.data.account,i=e.data.accountType,o=e.data.randomPassword,t=this.$el.find("#ucAccount"),n=this.$el.find("#randomPassword");t.html(s),t.attr({"data-value":s,"data-acType":i}),n.attr("data-value",o),n.html(o)}},returnGameAndLogin:function(e){this._setElementDisabledOrEnable(!0);var s=$(e.target);if("true"===s.data("returngame")){var i,o,t=this,n=!0;"registerNow"===s.data("regType")?(i=this.$el.find("#regNowUcAccount").data("ucid"),o=this.$el.find("#regNowPassword").data("password"),n=this.$el.find("#regNowIconCheckbox").hasClass("on")):(i=this.$el.find("#regUcAccount").data("ucid"),o=this.$el.find("#regPassword").data("password"));var a=t._showLoading(),c={account:i,password:o,isAutoLogin:n};t.controller.loginSubmit(c,!1,t.controller.callBackMix(function(e){t._hideLoading(a),ucf.Cache.set("openTestGame_"+i,e.get("openTestGame"),3600,!0),ucf.Cache.set("isAlpha_"+i,e.get("isAlpha"),3600,!0);var s=e.get("isCheckCaptcha");1==s?sdk.PageCache.set("isCheckCaptcha_"+i,s):sdk.PageCache.del("isCheckCaptcha_"+i),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ucidbindgame_b"]);var o=t.$el.find("#ucAccount"),n=o.attr("data-value"),c=o.attr("data-acType");t.doLoginCheck(c,n),sdk.PageCache.del("login_param")},function(e,s){t._hideLoading(a),_.isUndefined(s.data)||_.isUndefined(s.data.isCheckCaptcha)||1!=s.data.isCheckCaptcha?sdk.PageCache.del("isCheckCaptcha_"+i):sdk.PageCache.set("isCheckCaptcha_"+i,s.data.isCheckCaptcha);var o="登录失败";13==s.code?(o="请输入验证码",t.$el.find("#regSuccessPopup").addClass("ms-none"),t.loginOptions=c,t.captchaForReg=!0,t._showCaptchaPopup()):o=s.msg||o,t._showErrorMsg(o)}))}},bindModifyAndLogin:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ucidbindmodifypwok_b"]),this.modifyAndLogin()},loginPageModifyAndLogin:function(){this.accountType===this.controller.CONFIG.ACCOUNT_TYPE.LOGIN?(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_loginmodifypwok_b"]),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_randomPw_modify_b"])):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_oldidbindmodifypwok_b"]);var e=this.$el.find("#randomPwdRemind").html().substr(0,5);"你使用的是"==e?sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_randomPw_modify_i_opt"]):"随机密码已"==e&&sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_randomPw_modify_i_force"]),this.modifyAndLogin()},forceModifyAndLogin:function(){var e=this.$el.find("#updateHint"),s=this.$el.find("#forcePassword"),i=e.attr("account"),o=(e.attr("accountType"),e.attr("password")),t=s.val(),n=s.attr("type"),a=this;if("password"==n)if(o==t)this.generalController.setCacheData("user_info_"+i,{random:!1},0,!0),this._hidePopBox(),this.doLoginSuccess(this.model,this.resp);else{sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_retypePw_w"]);var c=this.$el.find("#forcePwd");c.html(""),c.append('<input id="forcePassword"  type="text" class="input_box" placeholder="重新输入密码" />'),e.html("密码错误，请确认后重新输入")}else sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_overtimePw_b"]),S.SSCT.GetHandler("Controller","User").updatePass({oldPassword:o,password:t,isPostPass:!0},S.SSCT.GetHandler("Controller","User").callBackMix(function(){a._hidePopBox(),a.doLoginSuccess(a.model,a.resp)},function(e){a._showErrorMsg(e,"#loginSuccessNoticeBox")}))},modifyAndLogin:function(){var e=this,s=this.$el.find("#accountParam"),i=this.$el.find("#newPassword").val(),o=s.attr("data-value"),t=s.attr("data-acType"),n=s.attr("data-password"),a="callback"===this.$el.find(".modifyAndLoginBtn").attr("data-callback")?!0:!1;S.SSCT.GetHandler("Controller","User").updatePass({oldPassword:n,password:i,isPostPass:!0},S.SSCT.GetHandler("Controller","User").callBackMix(function(){var s;a&&(s=function(){e.$el.find("#passwordLabel").html("密码");var s=e.$el.find("#randomPassword");s.html(i),s.attr("data-value",i),e._hidePopBox()}),e.doLoginCheck(t,o,s)},function(s){e._showErrorMsg(s,"#loginSuccessNoticeBox")}))},existUCAccount:function(){this._hideLoading(this.loginLoadingEl),this._showExsitAccountBox()},toSecrecyPage:function(e,s,i,o,t){var n=this;if(!t)var a=this._showLoading();this.controller.validSecrecy(e,s,this.controller.callBackMix(function(){t?n._hideLoading(t):n._hideLoading(a),sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["bindSecrecyMobile"]),1==o?sdk.Url.location.route("#!secrecy/preBind/pwFalse"):sdk.Url.location.route("#!secrecy/preBind/loginpage")},function(){t?n._hideLoading(t):n._hideLoading(a),i()}))},checkNerverNotice:function(){var e=this.$el.find("#isNerverNotice");"checked"===e.attr("data-value")?(e.attr("data-value",""),e.removeClass("cbbg")):(e.attr("data-value","checked"),e.addClass("cbbg"))},useUCAccountLogin:function(){var e=this.userController.getCurUser(),s=this.generalController.getCacheData("user_info_"+e.ucid,!0);s&&(e.isRandomPassword=s.random,e.randomPassword=e.isRandomPassword?s.password:e.randomPassword);var i=!(!1===e.isRandomPassword||0===e.randomPassword.length);i?this.userController.checkNoticeInfo(e.ucid,"updatePassword")?this.doLoginCheck(this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN,e.ucid):this._showUpdateRandomPassBox({accountType:this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN,account:e.ucid,randomPassword:e.randomPassword}):this.doLoginCheck(this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN,e.ucid)},setUsername:function(e){this.$el.find("#username").val(e)},setLastLoginTime:function(e){_.isUndefined(e)&&(e=-1),this.$el.find("#username").attr("lastLoginTime",e)},getLastLoginTime:function(e){var s=-1,i=this.$el.find("#username");return i.val()==e&&(_.isUndefined(i.attr("lastLoginTime"))||_.isEmpty(i.attr("lastLoginTime"))||(s=i.attr("lastLoginTime"))),s},setPassword:function(e,s){this.$el.find("#password").setInp(e).setModify(s)},logHist:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_otherid_b"])},selectHis:function(){var e=document.querySelector("#loginHistory"),s=e.options[e.selectedIndex],i=s.value,o=i||this.$el.find("#loginHistory").val();if("-1"!=o){var t={};this.controller.getHistByUsername(o,this.accountType,this.controller.callBackMix(function(e){t=e})),this._setAccount({account:t.account,password:t.password,isRandomPassword:t.isRandomPassword,lastLoginTime:t.lastLoginTime}),this._setAccountCheckedLastLoginTime(t.account,!1)}},checkRememPassword:function(e){var s,i=e.target,o=i.getAttribute("data-checked");"checked"===o?(s="",$(i).removeClass(this.localConfig.checkedClass)):(s="checked",$(i).addClass(this.localConfig.checkedClass)),i.setAttribute("data-checked",s)},resetUsername:function(){this.setUsername(""),this.setLastLoginTime(-1),this.resetPassword()},resetPassword:function(){this.setPassword("")},cancelUCAccountLogin:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_oldidbindpass_b"]);var e=this.userController.getCurUser();this.userController.setNerverNotice(e.ucid,!0),this.doLoginCheck(this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN,e.ucid)},neverUpdatePass:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_randomPw_opt_no_l"]);var e=this.userController.getCurUser();this.$el.find(".btnClick-none").removeClass("btnClick-none"),this._hidePopBox(),this.doLoginCheck(this.accountType,e.ucid)},cancelModify:function(){this._hidePopBox()},forgetPassword:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_forgetpw_l"]),S.Url.location.route("#!findPassword/passwordRetake/messageRetake")},gotoAgreement:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_article_l"]),S.Url.location.route("#!user/agreement"),this.$el.find("#regSuccessPopup").hasClass("ms-none")||S.PageCache.set("sso_regSuccWin_params",this._popupParams),this.$el.find("#registerNowPopbox").isHide()||(this.$el.find("#registerNowPopbox").suiHide(),S.PageCache.set("sso_is_regNowWin_show",!0))},gotoGameLogin:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_oldid_l"]),S.Url.location.route("#!sso/gameLogin"),sdk.PageCache.del("login_param")},goBack:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_oldidbinducid_b"]),S.Url.back()},_setHistory:function(e,s,i){var o=this,t={isRandomPassword:!1,account:"",password:"",lastLoginTime:-1};this._getHistData(_.bind(function(n){o.loginHist=n;var a=this.controller.getHistLength(this.accountType);if(0===a||_.isUndefined(n[0]))o.$el.find("#showHistory").removeClass("ms-block").addClass("ms-ni");else{a>1?o.$el.find("#showHistory").removeClass("ms-ni").addClass("ms-block"):o.$el.find("#showHistory").removeClass("ms-block").addClass("ms-ni");var c=null,d=document.createDocumentFragment(),r=new Option("请选择账号","-1");d.appendChild(r),console.log(JSON.stringify(n)),_.each(n,function(s){_.isEmpty(e)||s.account!==e||(c=s),d.appendChild(new Option(s.account,s.account))}),o.$el.find("#loginHistory").append(d),e&&s?c={isRandomPassword:!1,account:e,rememberPassword:!0,password:s}:e&&null===c?c={isRandomPassword:!1,account:e,rememberPassword:!1,password:""}:null===c&&(c=n[0]),t.isRandomPassword=c.isRandomPassword,t.account=c.account,t.lastLoginTime=c.lastLoginTime,c.rememberPassword&&(t.password=c.password)}o._setAccount({account:t.account,password:t.password,isRandomPassword:t.isRandomPassword,securityType:i,lastLoginTime:t.lastLoginTime})},this),!0)},_flushInpt:function(e){_.isEmpty($(e.target).val())?$(e.target).val(""):$(e.target).val($(e.target).val()),$(window).width()>$(window).height()},_setAccount:function(e){var s;this.setUsername(e.account),this.setLastLoginTime(e.lastLoginTime),1==e.securityType?s=!1:0==e.securityType&&(s=!0),this.setPassword(e.password,s)},_showLoading:function(e){var s=S.common.ui.NoticeBox.loading(e);return s},_textLoading:function(){var e=S.common.ui.NoticeBox.loading("loading_text");return e},_hideLoading:function(e){S.common.ui.NoticeBox.hide(e,null,"remove")},_getHistData:function(e,s){var i=this,o=this.controller.getHistories(this.accountType);_.isUndefined(o)||s===!0?this.controller.getHistory(this.accountType,this.controller.callBackMix(function(s){e&&e(s)},function(e){i._showErrorMsg(e,"#errorEl")})):e&&e(o)},_showUpdateRandomPassBox:function(e){e.accountType==this.controller.CONFIG.ACCOUNT_TYPE.LOGIN?(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_loginmodifypw_w"]),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_randomPw_modify_w"])):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_oldidbindmodifypw_w"]),this.$el.find("input").addClass("btnClick-none");var s=this;this._showPopBox(template.render("updateRandomPassBoxTempl"),function(){s.loginCount<=10?(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_randomPw_opt_w"]),s.$el.find("#randomPwdRemind").html('你使用的是随机密码<em style="color:red;font-weight:bold;">(还可以使用'+(10-parseInt(s.loginCount))+"次)</em>，为了你的账号安全，请及时修改。")):(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_randomPw_force_w "]),s.$el.find("#randomPwdRemind").html("随机密码已到期，请设置密码后进入游戏。"),s.$el.find("#neverUpdateBtn").addClass("ms-none")),s.$el.find("#accountParam").attr({"data-value":e.account,"data-acType":e.accountType,"data-password":e.randomPassword})})},_setUpdatePassParam:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ucidbindmodifypw_b"]);var e=this.$el.find("#ucAccount");$("input").addClass("btnClick-none");var s=e.attr("data-value"),i=e.attr("data-acType"),o=this.$el.find("#randomPassword").attr("data-value");this._showUpdatePassBox({account:s,accountType:i,password:o})},_showUpdatePassBox:function(e){var s=this;this._showPopBox(template.render("updatePassBoxTempl"),function(){var i=s.$el.find("#accountParam");i.html(e.account),i.attr({"data-value":e.account,"data-acType":e.accountType,"data-password":e.password}),S.global.isThirdParty&&s.$el.find("#updatePassBoxAcLb").html(S.global.thirdParty.name+"账号:")})},_showExsitAccountBox:function(){var e=this.userController.getCurUser(),s=this.userController.checkNoticeInfo(e.ucid),i=this;s?this.doLoginCheck(this.controller.CONFIG.ACCOUNT_TYPE.GAME_LOGIN,e.ucid):(S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["existUCAccount"]}),this._showPopBox(template.render("ownUCAccountBoxTempl"),function(){i.$el.find("#bindTitle").html("我们发现你的《"+e.gameName+"》游戏老账号和"+i.accountName+"账号曾经绑定过。"),i.$el.find("#bindUcid").html(i.accountName+"账号："+e.ucid),S.global.isThirdParty&&(i.$el.find("#ownAccountBoxTitle").html("已绑定过"+i.accountName+"账号"),i.$el.find("#useUCAccountLogin").val("使用"+i.accountName+"账号登录"))}))},_showPopBox:function(e,s){var i=this;this.$body.addClass("btnClick-none"),_.delay(function(){sdk.EC.hideInput(),i.$el.find("#popBox").html(e),i.$el.find("#popup").removeClass("ms-none"),i._autoResizeMask("modifyPassMask"),S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!0}),document.addEventListener("backbutton",function(){i._hidePopBox()}),s.apply(i)},50)},_hidePopBox:function(){sdk.EC.showInput(),this.$el.find("#popup").addClass("ms-none"),this.$body.removeClass("btnClick-none"),$(".btnClick-none").removeClass("btnClick-none"),$(window).off("resize"),S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!1}),document.removeEventListener("backbutton"),this._setElementDisabledOrEnable(!0)},_showErrorMsg:function(e){this.generalController.sendClientMsg(e)},_randomPassword:function(){return"UCX"+Math.random().toString().substr(2,8)},setAccAutoLogin:function(){var e=this.$el.find("#iconCheckbox");e.hasClass("on")?(e.removeClass("on"),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_CloseAutoLogin_b","login"])):(e.addClass("on"),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_OpenAutoLogin_b","login"]))},modifyPassword:function(){var e=this.$el.find("#modifyPassBtn"),s=this.$el.find("#regPassword"),i=this.$el.find("#newPasswordSpan"),o=this.$el.find("#passwordName"),t=this.$el.find("#modifyResult"),n=e.val(),a=this.$el.find("#registerBut").data("type");if("修改密码"==n)"gameLogin"==a?sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_modifyPw_b_GameAccount"]):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_modifyPw_b_UCAccount"]),i.toggleClass("ms-ni"),s.toggleClass("ms-ni"),o.html("输入密码:"),e.val("    完成   "),t.css("color","grey"),t.html("点击空白区域可取消修改");else if("    完成   "==n){"gameLogin"==a?sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_PwConfirm_b_GameAccount"]):sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_sign_PwConfirm_b_UCAccount"]);var c=this.$el.find("#newPassword"),d=c.val();if(c.val(""),t.html(""),d.length<6||d.length>20)return this.hideModify(),t.css("color","red"),t.html("密码格式错误！"),void 0;sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_signmodifypwok_b"]);var r={isPostPass:!0,oldPassword:s.html(),password:d},l=this;l._hideLinkEffect(),this.userController.registerUpdatePass(r,this.controller.callBackMix(function(){t.css("color","#333333"),t.html("密码修改成功！"),i.toggleClass("ms-ni"),s.toggleClass("ms-ni"),o.html("账号密码:"),e.val("修改密码"),s.html(d).data("password",d),l._popupParams&&(l._popupParams[1]=d),l.randomPwd=!1;
var n=l.$el.find("#regUcAccount").html();sdk.PageCache.set("login_param",{accountType:l.controller.CONFIG.ACCOUNT_TYPE.LOGIN,account:n,password:d,randomPassword:""}),l._hideLinkEffect()},function(e){l.hideModify(),t.css("color","red"),t.html(e)}))}},hideModify:function(e){if(!e||"modifyPassBtn"!=e.target.id&&"newPassword"!=e.target.id&&"returnGameBtn"!=e.target.id){this.$el.find("#newPasswordSpan").addClass("ms-ni"),this.$el.find("#regPassword").removeClass("ms-ni"),this.$el.find("#modifyPassBtn").val("修改密码");var s=this.$el.find("#passwordName");"账号密码:"!=s.html()&&(this.randomPwd?s.html("随机密码:"):s.html("账号密码:"),this.$el.find("#modifyResult").html("&nbsp;"))}},_restoreRegSuccWin:function(){var e=sdk.PageCache.get("sso_regSuccWin_params");e.success&&e.data&&(sdk.PageCache.del("sso_regSuccWin_params"),this._setRegSuccPopup.apply(this,e.data))},_setRegSuccPopup:function(e,s,i,o){if(this.$el.find("#regUcAccount").html(e).data("ucid",e),this.$el.find("#regPassword").html(s).data("password",s),this.$el.find("#registerReturnGameBtn").data("regType","firstGameLogin"),this.$el.find("#password").addClass("ms-ni"),this.$el.find("#username").addClass("gr-vshid"),this.$body.addClass("btnClick-none"),this.$el.find("#regSuccessPopup").removeClass("ms-none"),this._popupParams=[e,s,i,o],i){o&&this.$el.find("#passwordName").html("账号密码:");var t=this.$el.find("#gameNotice");t.css("margin","10px 10px -10px 15px"),t.css("color","grey"),t.html("为提供更好的游戏服务，我们为您分配了新的"+this.accountName+"账号。"),this.$el.find("#regSuccTitle").html("老账号绑定新"+this.accountName+"账号"),this.$el.find("#regAgree").removeClass("ms-none")}this._setElementDisabledOrEnable(!1),this._autoResizeMask("regPopupMask")},_showCaptchaPopup:function(){this._setElementDisabledOrEnable(!1);var e=this;this._showPopBox(template.render("captchaTempl"),function(){var s=this.$el.find("#captchaImg"),i=this.$el.find("#captchaTips"),o=this.$el.find("#captchaInput");e.isNeedCaptcha=!0,sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_captcha_dialog_show"]),s.addClass("ms-none"),i.text("获取中...").removeClass("ms-none"),e.getCaptcha(e.loginOptions.account,{success:function(s){i.text("").addClass("ms-none"),o.val(""),e._showCaptchaImg(s.img)},error:function(){i.text("获取失败")}})})},_hideCaptchaPopup:function(){this.isNeedCaptcha=!1,this._hidePopBox(),this.$el.find("#captchaImg").addClass("ms-none"),this.$el.find("#captchaInput").val(""),this.$el.find("#captchaTips").addClass("ms-none")},refreshCaptcha:function(){if(!this.isGettingCaptcha){var e=this,s=this.$el.find("#captchaImg"),i=this.$el.find("#captchaTips"),o=this.$el.find("#captchaInput");s.addClass("ms-none"),i.text("获取中...").removeClass("ms-none"),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_captcha_refresh"]),this.getCaptcha(this.loginOptions.account,{success:function(s){i.text("").addClass("ms-none"),o.val(""),e._showCaptchaImg(s.img),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_captcha_refresh_success"])},error:function(){i.text("获取失败")}})}},getCaptcha:function(e,s){var i=this;this.isGettingCaptcha=!0,this.controller.getLoginCaptcha(e,{success:function(e){_.isUndefined(e.img)||_.isEmpty(e.img)?s.error&&s.error(resp):s.success&&s.success(e),setTimeout(function(){i.isGettingCaptcha=!1},0)},error:function(e){s.error&&s.error(e),setTimeout(function(){i.isGettingCaptcha=!1},0)}})},_showCaptchaImg:function(e,s){(_.isUndefined(s)||_.isEmpty(s))&&(s="jpeg"),_.isUndefined(e)||_.isEmpty(e)||this.$el.find("#captchaImg").attr("src","data:image/"+s+";base64,"+e).removeClass("ms-none")},_setElementDisabledOrEnable:function(e){e===!0?(this.$body.removeClass("btnClick-none"),this.$el.find("#username").removeAttr("disabled").removeClass("gr-vshid"),this.$el.find("#password").removeAttr("disabled").removeClass("ms-ni"),this.$el.find("#loginHistory").removeAttr("disabled")):(this.$body.addClass("btnClick-none"),this.$el.find("#username").attr("disabled","disabled"),this.$el.find("#password").attr("disabled","disabled"),this.$el.find("#loginHistory").attr("disabled","disabled"))},_autoResizeMask:function(e){function s(){var e=parseInt($(window).height()),s=parseInt($(document).height());return e>s?e:s}var i=this.$el.find("#"+e);i.height(s()),$(window).on("resize",function(){i.height(s())})},displayContentByChannel:function(){S.global.isThirdParty?(S.global.thirdParty.login.headerLogo.length>0?this.$el.find("#loginTabLogo").attr("src",S.global.thirdParty.login.headerLogo).removeClass("ms-ni"):(this.$el.find("#loginTitleTabs").addClass("ms-ni"),this.$el.find("#loginTitleTabs2").removeClass("ms-ni"),this.$el.find("#loginTitleText").text(S.global.thirdParty.login.headerTitle)),this.$el.find("#username").attr("placeholder",this.accountName+"账号"),this.$el.find("#agreementBtn").html("注册即遵守《"+this.accountName+"服务条款》"),this.$el.find("#regSuccTitle").html("成功注册"+this.accountName+"账号"),this.$el.find("#regSucPopAccountLb").html(this.accountName+"账号:"),this.$el.find("#agreementBtn").html(this.accountName+"服务条款"),this.$el.find("#updatePassBoxAcLb").html(this.accountName+"账号"),this.$el.find("#registerNowPopbox").find("#agreementBtn").html(this.accountName+"服务条款")):(this.$el.find("#loginTabLogo").removeClass("ms-ni"),this.$el.find("#username").attr("placeholder","UC账号\\手机"))},_isLoginStateInvalid:function(e,s){var i=!1;if(!_.isUndefined(s)&&-1==this.checkedLastLoginTimeAccounts.indexOf(e)){var o=new Date,t=Date.parse(o)+o.getMilliseconds();t-s>=7776e6&&(i=!0,this._setAccountCheckedLastLoginTime(e,!0))}return i},_passwordValueChange:function(){var e=this.$el.find("#username").val();this._setAccountCheckedLastLoginTime(e,!0)},_setAccountCheckedLastLoginTime:function(e,s){_.isUndefined(e)||(s===!0&&-1==this.checkedLastLoginTimeAccounts.indexOf(e)?this.checkedLastLoginTimeAccounts+=e+"_":s===!1&&-1!=this.checkedLastLoginTimeAccounts.indexOf(e)&&(this.checkedLastLoginTimeAccounts=this.checkedLastLoginTimeAccounts.replace(e+"_","")))}});S.SSVW.User=Backbone.View.extend({el:"#userContainer",events:{"onclick #oldPass,#newPass,#regGuestPassword,#passwordToBind":"flushInpt","onclick #changePassBtn":"gotoUpdatePass","onclick #confirmChangePass":"doUpdatePass","onclick #payHistoryBtn":"gotoPayHistory","onclick #logoutBtn":"logout","onclick #feedBackBtn":"gotoFeedBack","onclick #existAccountBtn":"gotoLogin","onclick #toSecrecyBtn":"gotoSecrecy","onclick #changeNickname":"changeNickname","onclick #submitNicknameBtn":"submitNickname","onclick #accountSecureBtn":"gotoAccountSecure","onclick #gotoSecCenterBtn":"gotoSecCenter","onclick #rechargeBtn":"gotoRecharge","onclick #exitBtn":"curLogout","onclick #activeAgreementBtn":"gotoAgreement","onclick #bindUCAccount":"gotoActivate","onclick #bindUCAccountPlf":"gotoActivatePlf","onclick #regGuest":"registerGuestAccount","onclick #activateGuest":"bindGuestAccount","onclick #bindReturn":"bindReturn","change  #bindLoginHistory":"selectHis","onclick #bindLoginHistory":"logHist","onclick #userBaseInfo":"hideEditNickname","onclick #autoLoginSwitch":"setAutoLoginStatus"},pageScroll:{},redirectTitle:void 0,redirectUrl:void 0,_enableUserChange:!1,config:{SECURITY_TYPE:{UNSECURITY:0,SECURITY:1}},initialize:function(){_.bindAll(this),this.controller=S.SSCT.GetHandler("Controller","User"),this.ssoController=S.SSCT.GetHandler("Controller","Sso"),this.generalController=S.SSCT.GetHandler("Controller","General"),this.$body=$("body");var e=S.global.versionCompare(S.global.version,rConfig.VERSIONS.SECURITY_VERSION);e!==!1&&e>=0?this.$body.data("ctrl","true"):this.$body.data("ctrl","")},userInfo:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["management"]});var e=this;S.global.isThirdParty?this._userInfo(function(n){null==n?(e.controller.sdkExit(),e._showErrorMsg("请求失败")):_.isUndefined(n.sid)||!_.isUndefined(n.sid)&&_.isEmpty(n.sid)?(e.controller.sdkExit(),e._showErrorMsg("请重新登录")):(e.entranceControl4ThirdParty(),e.renderBaseInfo4ThirdParty())}):(this._userInfo(),this.entranceControl(),this.renderBaseInfo())},updatePassword:function(){S.SCEV.Proxy.trigger(S.SCEV.EventType.PRE_ROUTE,{enterPage:sdk.Log.businesses.PAGE_USER,enterBusiness:["updatePassword"]}),this._userInfo();var e=this.controller.getCurUser();this.controller.userName;var n=this.$el.find("#newPass");this.$el.find("#up-nickname").html(""),this.$el.find("#up-ucid").html(e.ucid),n.val(""),n.attr("placeholder","请输入6-20位字母或数字");var i=this.generalController.getCacheData("user_info_"+e.ucid,!0);_.isUndefined(i)||_.isEmpty(i)||!i.random||(e.isRandomPassword=!0,e.randomPassword=i.password);var s=this.$el.find("#oldPass"),o=this;e.isRandomPassword?(s.attr("placeholder",""),s.val(e.randomPassword)):(s.val(""),s.attr("placeholder","请输入6-20位字母或数字")),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_REMOVE_WIN_EVENT,{eventName:"bridgeTopBtnClicked"}),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_WINDOW_EVENT,{eventName:"bridgeTopBtnClicked",handler:function(e){"doUpdatePass"==e.action&&o.doUpdatePass()}})},renderBaseInfo:function(){var e=this,n=S.SSCT.GetHandler("Controller","AccountManage"),i=this.$el.find("#secureState");i.removeClass("red");var s=!0;sdk.PageCache.del("risk");var o=this.controller.getCurUser();_.isUndefined(o)||_.isUndefined(o.accountType)||o.accountType!=rConfig.ACCOUNT_TYPE.QQ||(s=!1),s&&(this.$el.find("#usrCtrlSafe").removeClass("ms-ni"),n.getSecureStateDetail(["mobile","question"],n.callBackMix(function(e){_.isUndefined(e.mobile)&&_.isUndefined(e.question)||1!==e.mobile.code||1!==e.question.code&&126!==e.question.code?(i.text("获取失败"),sdk.PageCache.set("risk","fail")):_.isEmpty(e.mobile.mobile)&&_.isEmpty(e.question.password_question)?(i.text("未设置"),i.addClass("red"),sdk.PageCache.set("risk","none")):_.isEmpty(e.mobile.mobile)||_.isEmpty(e.question.password_question)?_.isEmpty(e.question.password_question)?_.isEmpty(e.mobile.mobile)||(i.text("手机"),sdk.PageCache.set("risk","mobile"),sdk.PageCache.set("secrecy_binding_mobile",e.mobile.mobile)):(i.text("密保问题"),sdk.PageCache.set("risk","question")):(i.text("手机、密保问题"),sdk.PageCache.set("risk","both"),sdk.PageCache.set("secrecy_binding_mobile",e.mobile.mobile))},function(){i.text("获取失败"),sdk.PageCache.set("risk","fail")})));var t=S.SSCT.GetHandler("Controller","Pay");t.getUPointBalance(t.callBackMix(function(n){e.$el.find("#uPointBalance").text("余额："+n.get("balance")+" U点")},function(n){e._showErrorMsg(n)}));var r=S.global.versionCompare(S.global.version,rConfig.VERSIONS.AUTO_LOGIN_VERSION);r!==!1&&r>=0?(this.$el.find("#autoLoginSetting").removeClass("ms-ni"),this.$el.find("#autoLoginNoti").removeClass("ms-ni")):(this.$el.find("#autoLoginSetting").addClass("ms-ni"),this.$el.find("#autoLoginNoti").addClass("ms-ni")),this.$el.find("#userInfoDetailBtn").removeAttr("disabled"),this.controller.getCurUserInfo();var a=this.controller.getCurUser(),l="UC用户";_.isUndefined(a.nickname)||_.isEmpty(l)||(l=a.nickname,l.length>rConfig.user.showUserNickLen&&(l=l.substr(0,rConfig.user.showUserNickLen-1)+"...")),this.$el.find("#sdkVersion").html(eConfig.version),this.$el.find("#userInfoNickname").html(l),this.$el.find("#userInfoUcid").html(a.ucid),this.controller.getFeatureSwitch(this.controller.callBackMix(function(n){e._enableUserChange=_.isBoolean(n.enableUserChange)?n.enableUserChange:e._enableUserChange,n.enableUserChange&&e.$el.find("#exitBtn").removeClass("ms-ni")})),this.generalController.getClientConfig(this.generalController.callBackMix(function(n){_.isUndefined(n)||_.isUndefined(n.isShowVip)||1!=n.isShowVip?e.$el.find("#becomeVipBtn").remove():(e.$el.find("#userInfoVipArea").removeClass("ms-none"),e.$el.find("#becomeVipBtn").removeClass("ms-ni"),e.controller.getVipInfo({success:function(n){_.isUndefined(n)||_.isUndefined(n.status)||1!=n.status?(e.$el.find("#vipImgGray").removeClass("ms-none"),e.$el.find("#lightVip").removeClass("ms-none"),e.$el.find("#vipSpace").hide()):e.$el.find("#vipImgDefault").removeClass("ms-none")},error:function(){e.$el.find("#vipImgGray").removeClass("ms-none"),e.$el.find("#lightVip").removeClass("ms-none"),e.$el.find("#vipSpace").hide()}}))},function(){}))},renderBaseInfo4ThirdParty:function(){var e=this,n=this.controller.getCurUser(),i=_.isUndefined(n.account)?"":n.account;this.$el.find("#myAccount").text(i);var s=S.global.versionCompare(S.global.version,rConfig.VERSIONS.AUTO_LOGIN_VERSION);s!==!1&&s>=0?(this.$el.find("#autoLoginSetting").removeClass("ms-ni"),this.$el.find("#autoLoginNoti").removeClass("ms-ni")):(this.$el.find("#autoLoginSetting").addClass("ms-ni"),this.$el.find("#autoLoginNoti").addClass("ms-ni")),this.$el.find("#sdkVersion").html(eConfig.version),this.controller.getFeatureSwitch(this.controller.callBackMix(function(n){e._enableUserChange=_.isBoolean(n.enableUserChange)?n.enableUserChange:e._enableUserChange,n.enableUserChange&&e.$el.find("#exitBtn").removeClass("ms-ni");var i=e.$el.find("#autoLoginSwitch"),s=e.$el.find("#autoLoginNoti");n.isAutoLogin?(i.addClass("on"),s.html("关闭后每次进入游戏时可重新选择账号进行登录。")):(i.removeClass("on"),s.html("开启后将自动使用最近登录的账号进入游戏。"))}))},entranceControl:function(){var e=!1,n=this;this.controller.getFeatureSwitch(this.controller.callBackMix(function(i){var s=n.$el.find("#payHistoryBtn");if(i.enablePayHistory)s.removeClass("ms-ni").addClass("p-last-border"),e=!0;else{var o=n.$el.find("#rechargeBtn");o.length>0&&(o[0].style.webkitBorderRadius="5px"),s.addClass("ms-ni")}if(i.enableUserChange){var t=n.$el.find("#logoutBtn");t.parent().removeClass("ms-none"),e||t.parent().addClass("p-last-border")}var r=n.$el.find("#autoLoginSwitch"),a=n.$el.find("#autoLoginNoti");i.isAutoLogin?(r.addClass("on"),a.html("关闭后每次进入游戏时可重新选择账号进行登录。")):(r.removeClass("on"),a.html("开启后将自动使用最近登录的账号进入游戏。"))},function(){}))},entranceControl4ThirdParty:function(){S.global.thirdParty.userCenter.bottomTips.inVisibile&&this.$el.find("#bottomTips").hide(),S.global.thirdParty.userCenter.bbs.inVisibile&&this.$el.find("#bbsArea").hide();var e=2;S.global.thirdParty.userCenter.account.inVisibile&&(this.$el.find("#myAccountBtn").hide(),this.$el.find("#accountArea").addClass("usrCtrl_sg"),e--),S.global.thirdParty.userCenter.updatePassword.inVisibile&&(this.$el.find("#changePassBtn").hide(),this.$el.find("#accountArea").addClass("usrCtrl_sg"),e--),0==e&&this.$el.find("#accountArea").addClass("ms-ni"),this.$el.find("#bbsBtn").bind("click",function(){window.location.href=S.global.thirdParty.bbs.link})},doUpdatePass:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_ModifyPW_sumit_b"]);var e=this.$el.find("#oldPass").val(),n=this.$el.find("#newPass").val();if(!e)return this._showErrorMsg("请输入旧密码"),void 0;if(!n)return this._showErrorMsg("请输入新密码"),void 0;this.controller.setCurUser({}),this.$el.find("#confirmChangePass").attr("disabled","disabled");var i={oldPassword:e,password:n,isPostPass:!0},s=this;this.controller.updatePass(i,this.controller.callBackMix(function(){s.controller.getCurUserInfo(s.controller.callBackMix(function(){s.$body.addClass("btnClick-none"),s._showErrorMsg("更新密码成功"),S.Url.back()},function(){S.Url.location.route("#!sso/login")}))},function(e){s._showErrorMsg(e),s.$el.find("#confirmChangePass").removeAttr("disabled")}))},flushInpt:function(e){_.isEmpty($(e.target).val())&&$(e.target).val(""),_.isUndefined(this.noticeBar)||_.isEmpty(this.noticeBar)||sdk.common.ui.NoticeBox.hide(this.noticeBar,null,"slide")},logout:function(){this.generalController.jumpToNativePage({uiBusiness:"login"})},_userInfo:function(e){var n=this;this.controller.getCurUserInfo(this.controller.callBackMix(function(i){var s=S.global.versionCompare(S.global.version,rConfig.VERSIONS.SECURITY_VERSION);s!==!1&&s>=0&&(_.isUndefined(i.isRandomPassword)||0!=i.isRandomPassword||_.isUndefined(i.account)||n.generalController.setCacheData("user_info_"+i.account,{random:!1},0,!0)),e&&e(i)},$.proxy(function(){this.generalController.getSourcePageInfo(this.generalController.callBackMix(function(e){n.generalController.jumpToNativePage(e)},function(){S.Url.location.route("#!sso/login")})),e&&e(null)},this)))},gotoUpdatePass:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_account_ModifyPW_l"]),S.Url.location.route("#!user/updatePassword")},gotoPayHistory:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_account_PayRecord_l"]);var e=window.location.href.match("user/user.html")?"user/user.html#!user":"user/user_landscape.html#!user",n=window.location.href.replace(e,"pay/pay.html#!pay/history/"+S.SSCT.GetHandler("Controller","User").getCurUser().gameName);sdk.Log.pageEnter(sdk.Log.businesses.PAGE_PAY,["payHistory"]),S.Url.redirect(eConfig.payHistoryUrl+(eConfig.payHistoryUrl.indexOf("?")>=0?"&":"?")+"p="+encodeURIComponent(n))},gotoLogin:function(){var e=this;this.generalController.getSourcePageInfo(this.generalController.callBackMix(function(n){e.generalController.jumpToNativePage(n)},function(){S.Url.location.route("#!sso")}))},gotoFeedBack:function(){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["feedBack"]),sdk.PageCache.set("feedBack_result_url",window.location.href);var e=S.SSCT.GetHandler("Controller","Game"),n=this;e.getGameInfo(e.callBackMix(function(e){S.Url.redirect(eConfig.feedBackCenter+"?uid="+n.controller.getCurUser().ucid+"&uname="+n.controller.getCurUser().nickname+"&gid="+e.gameId+"&gname="+n.controller.getCurUser().gameName+"&skey=D02")}))},gotoSecrecy:function(){S.Url.location.route("#!secrecy/preBind/usercenter")},_getHistData:function(e,n){var i=this,s=rConfig.ACCOUNT_TYPE.UC,o=this.ssoController.getHistories(s);!o||n?this.ssoController.getHistory(s,this.controller.callBackMix(function(n){e&&e(n)},function(e){i._showErrorMsg(e)})):e&&e(o)},curLogout:function(){var e=this;sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_Account_Logout_b"]),sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_Account_Logout_w"]),this._confirm({title:'<div><center><p class="gr-f16">确定要退出当前账号？</p></center></div>',confirm:"退出账号",cancel:"取消"},function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_Account_LogoutOK_b"]),S.sdkBase.request(S.sdkBase.servType.LOGIN,S.sdkBase.actions.LOGOUT),e.controller.notifyCp({code:1,msg:""},{success:function(){e.controller.sdkExit()},error:function(){e._showErrorMsg("通知游戏失败")}},"logout"),sdk.PageCache.set("clear_history",1)},function(){})},_showErrorMsg:function(e){this.generalController.sendClientMsg(e)},changeNickname:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_account_NicknameModify_b"]),this.$el.find("#userInfoNickname").toggleClass("hide"),this.$el.find("#changeNickname").toggleClass("hide"),this.$el.find("#editNickname").toggleClass("hide"),this.$el.find("#submitNicknameBtn").toggleClass("hide"),this.$el.find("#editNickname").val("")},hideEditNickname:function(e){"editNickname"!=e.target.id&&"changeNickname"!=e.target.id&&this.$el.find("#userInfoNickname").hasClass("hide")&&this.changeNickname()},submitNickname:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_account_NicknameModifyOK_b"]);var e=this.$el.find("#editNickname").val();if(!e)return this._showErrorMsg("请输入昵称"),void 0;this.controller.setCurUser({});var n={uid:this.$el.find("#userInfoUcid").text(),userName:e},i=this;this.controller.updateNickname(n,this.controller.callBackMix(function(){i.controller.getCurUserInfo(i.controller.callBackMix(function(){i._showErrorMsg("修改昵称成功"),e.length>rConfig.user.showUserNickLen&&(e=e.substr(0,rConfig.user.showUserNickLen-1)+"..."),i.$el.find("#userInfoNickname").text(e)},function(){S.Url.location.route("#!sso/login")}))},function(e){"userName_isExist"==e?i._showErrorMsg("用户名已存在"):i._showErrorMsg(e)}))},gotoAccountSecure:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_account_AccountSafe_l"]),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_REMOVE_WIN_EVENT,{eventName:"bridgeTopBtnClicked"}),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_WINDOW_EVENT,{eventName:"bridgeTopBtnClicked",handler:function(e){"backToUser"==e.action&&(sdk.common.ui.MsgBox.remove(),S.Url.back())}}),this.$el.find("#secureState"),sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["accountSecure"]),S.Url.location.route("#!secrecy/preBind/usercenter")},gotoSecCenter:function(){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["accountSecure"]),sdk.Log.pageClose(sdk.Log.businesses.PAGE_USER,["accountSecure"]),sdk.PageCache.set("sdk_redirect_out",1);var e=eConfig.secureUrl+"?uc_param_str=frpfvesscpmilaprnisieiut&appId=17"+"&backUrl="+encodeURIComponent(eConfig.sdkExitBackUrl);S.Url.redirect(e)},gotoRecharge:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_account_PayUpoint_l"]),sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["udPay"]),sdk.Log.pageClose(sdk.Log.businesses.PAGE_USER,["udPay"]),sdk.PageCache.set("sdk_redirect_out",1);var e={},n=this,i=S.sdkBase.request(S.sdkBase.servType.COMMON,S.sdkBase.actions.GET_GAME_INFO);i&&i.success&&(e.gameId=i.data.gameId,e.serverId=i.data.serverId,e.upayPage=rConfig.apis.U_PAY_PAGE,this.controller.rechargeUPoint(e,{success:function(e){S.Url.redirect(e.url)},error:function(e){n._showErrorMsg(e.msg)}}))},gotoAgreement:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_article_l"]),S.Url.location.route("#!user/agreement")},gotoActivate:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_formaloldid_l"]),S.Url.location.route("#!user/activate")},gotoActivatePlf:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_formaloldid_l"]),S.Url.location.route("#!user/activatePlf")},activate:function(){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["h5a_formaloldid_p"]),this._backButtonHandle(function(e){"activeBackGame"==e.action&&(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_leaveformaloldid_b"]),S.SSCT.GetHandler("Controller","User").sdkExit())});var e,n,i=sdk.PageCache.get("auto_login_info"),s=S.SSCT.GetHandler("View","Sso"),o=S.SSCT.GetHandler("Controller","Sso"),t=this;i.data&&(e=i.data.account,n=i.data.password),s._getHistData(function(i){var s=o.getHistLength(0);if(0===s||_.isUndefined(i[0]))t.$el.find("#bindLoginHistory").removeClass("ms-block").addClass("ms-ni");else{s>1?t.$el.find("#bindLoginHistory").removeClass("ms-ni").addClass("ms-block"):t.$el.find("#bindLoginHistory").removeClass("ms-block").addClass("ms-ni");var r=document.createDocumentFragment(),a=new Option("请选择账号","-1");r.appendChild(a),_.each(i,function(e){r.appendChild(new Option(e.account,e.account))}),t.$el.find("#bindLoginHistory").append(r)}e&&n?(t.$el.find("#ucAccountToBind").val(e),t.$el.find("#passwordToBind").setInp(n)):i[0]&&(t.$el.find("#ucAccountToBind").setInp(i[0].account),t.$el.find("#passwordToBind").setInp(i[0].password))},!0)},activatePlf:function(){this.activate()},regActivate:function(){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["h5a_formalsign_p"]),this._backButtonHandle(function(e){"regActiveBackGame"==e.action&&(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_leaveformalsign_b"]),S.SSCT.GetHandler("Controller","User").sdkExit())})},regActivatePlf:function(){this.regActivate();var e=sdk.common.utils.Url.getQueryStringArgs();e.title&&(this.redirectTitle=e.title,this.redirectUrl=e.redirectUrl,this.$el.find("#activateHint").text("进入"+e.title+"前，请先注册账号并完成激活："))},logHist:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_otherid_b"])},selectHis:function(){var e=this.$el.find("#bindLoginHistory").val(),n=e||this.$el.find("#bindLoginHistory").val(),i=S.SSCT.GetHandler("Controller","Sso"),s=this;"-1"!=n&&i.getHistByUsername(n,0,this.controller.callBackMix(function(e){s.$el.find("#ucAccountToBind").val(e.account),s.$el.find("#passwordToBind").setInp(e.password)},function(){s.$el.find("#passwordToBind").setInp("")}))},registerGuestAccount:function(){function e(e){sdk.Log.click(sdk.Log.businesses.PAGE_USER,[e])}sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_formalsign_b"]),this.$el.find("#regGuest").addClass("btnClick-none");var n=this.$el.find("#regGuestEmail").val(),i=this.$el.find("#regGuestPassword").val(),s=(this.config.SECURITY_TYPE.UNSECURITY,this);if(n&&!n.match(rConfig.user.emailAccountFilter))return this._showErrorMsg("邮箱输入有误"),e("email_format_error"),void 0;if(i.length<6||i.length>20)return this._showErrorMsg("密码长度不符（6-20位）"),void 0;if(i.match(rConfig.user.passwordFilter))return this._showErrorMsg("密码必须为字母或数字"),void 0;var o={email:n,password:i,isRandomPassword:!1};this.controller.registerGuestAccount(o,this.controller.callBackMix(function(e){n.length>20&&(n=n.substr(0,19)+"..."),s.$el.find("#newUCID").text(e.data.ucid),s.$el.find("#bindEmail").text(n),n?s.$el.find("#bindEmailP").removeClass("ms-vshid"):s.$el.find("#bindEmailP").addClass("ms-vshid"),setTimeout($.proxy(function(){this.bindGuestAccountSuccess()},s),80)},function(n){n.msg.match("已被使用")&&e("email_is_used_error"),s._showErrorMsg(n.msg)}))},bindGuestAccountSuccess:function(){this._hideLinkEffect("bindReturn"),sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["h5a_formalsignok_p"]),this.redirectTitle&&this.$el.find("#bindReturn").val("进入"+this.redirectTitle);var e=this.$el.find("#registerGuestAccountSuccess");e.removeClass("ms-none")},bindGuestAccount:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_formaloldid_b"]);var e=this.$el.find("#ucAccountToBind").val(),n=this.$el.find("#passwordToBind").getInp(),i=this.$el.find("#passwordToBind").isModify(),s=i?this.config.SECURITY_TYPE.UNSECURITY:this.config.SECURITY_TYPE.SECURITY,o=this,t=S.global.versionCompare(S.global.version,rConfig.VERSIONS.SECURITY_VERSION);if(""==e)return this._showErrorMsg("请输入账号"),void 0;if(0===n.length)return this._showErrorMsg("密码不能为空"),void 0;if(t!==!1&&t>=0&&s===this.config.SECURITY_TYPE.SECURITY);else if(n.length<6||n.length>20)return this._showErrorMsg("密码长度不符（6-20位）"),!0;var r={account:e,password:n,accountType:0,rememberPassword:!0,isAutoLogin:!0,securityType:s},a=this._textLoading();this.controller.bindGuestAccount(r,this.controller.callBackMix(function(){o._hideLoading(a),o.redirectUrl?S.Url.redirect(o.redirectUrl):o.controller.sdkExit()},function(e){o._hideLoading(a),o._showErrorMsg(e.msg)}))},_textLoading:function(){var e=S.common.ui.NoticeBox.loading("loading_text");return e},_hideLoading:function(e){S.common.ui.NoticeBox.hide(e,null,"remove")},bindReturn:function(){sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5a_formalsignok_b"]),this.redirectUrl?S.Url.redirect(this.redirectUrl):this.controller.sdkExit()},_backButtonHandle:function(e){S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_REMOVE_WIN_EVENT,{eventName:"bridgeTopBtnClicked"}),S.SCEV.Proxy.trigger(S.SCEV.EventType.SDK_WINDOW_EVENT,{eventName:"bridgeTopBtnClicked",handler:e})},setAutoLoginStatus:function(){function e(){s.addClass("on"),o.$el.find("#autoLoginNoti").html("关闭后每次进入游戏时可重新选择账号进行登录。")}function n(){s.removeClass("on"),o.$el.find("#autoLoginNoti").html("开启后将自动使用最近登录的账号进入游戏。")}function i(e){e.msg&&_this._showErrorMsg(e.msg)}var s=this.$el.find("#autoLoginSwitch"),o=this;s.hasClass("on")?(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_CloseAutoLogin_b","usercenter"]),this.controller.setAutoLoginState({isAutoLogin:!1},{success:n,error:i})):(sdk.Log.click(sdk.Log.businesses.PAGE_USER,["h5_OpenAutoLogin_b","usercenter"]),this.controller.setAutoLoginState({isAutoLogin:!0},{success:e,error:i}))},_getAccParent:function(e){var n=e;return n=n.data("account")?n:n.parent(),n=n.data("account")?n:n.parent(),n=n.data("account")?n:n.parent()},_confirm:function(e,n,i){var s=this;this.$body.addClass("btnClick-none"),sdk.common.ui.MsgBox.show(e.title,{confirmName:e.confirm||"确定",cancelName:e.cancel||"取消",callBack:function(){s.$body.removeClass("btnClick-none"),sdk.common.ui.MsgBox.remove(),setTimeout(function(){n&&n()},10)},cancel:function(){s.$body.removeClass("btnClick-none"),sdk.common.ui.MsgBox.remove(),setTimeout(function(){i&&i()},10)}},"confirm",!0)}});S.SSVW.Vip=Backbone.View.extend({el:"#userContainer",events:{"onclick #cancelLightVipBtn":"cancelLightVip","onclick #keepGotoLightVipBtn":"keepGotoLightVip","onclick #becomeVipBtn":"gotoBecomeVip","onclick #lightVip":"gotoLightVip"},initialize:function(){},gotoBecomeVip:function(){sdk.Log.pageEnter(sdk.Log.businesses.PAGE_USER,["becomeVip"]),sdk.Log.pageClose(sdk.Log.businesses.PAGE_USER,["becomeVip"]),sdk.PageCache.set("sdk_redirect_out",1);var e=eConfig.becomeVip;S.Url.redirect(e)},gotoLightVip:function(){$("body").addClass("btnClick-none");var e=this;S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!0}),document.addEventListener("backbutton",function(){e.cancelLightVip()});var i=document.body.clientHeight+"px";this.$el.find("#lightVipMask").css("height",i),this.$el.find("#isLightVipBox").css("display","block")},cancelLightVip:function(){S.sdkBase.request(S.sdkBase.servType.APP,S.sdkBase.actions.OVERRIDE_BACK_BTN,{override:!1}),this.$el.find("#isLightVipBox").css("display","none"),$("body").removeClass("btnClick-none")},keepGotoLightVip:function(){S.Url.redirect(eConfig.lightVip),this.cancelLightVip()}});